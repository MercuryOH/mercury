{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { createContext, useContext, useEffect, useState } from 'react';\nimport { useRouter } from 'next/router';\nimport Cookies from 'js-cookie';\nimport * as api from '../util/mercuryService';\nimport { Segment } from 'semantic-ui-react';\nvar MERCURY_TOKEN = 'mercury-token';\nvar AuthContext = createContext({});\nexport function AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n  var router = useRouter();\n\n  var _useState = useState(null),\n      user = _useState[0],\n      setUser = _useState[1];\n\n  var _useState2 = useState(true),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  useEffect(function () {\n    function loadUserFromCookies() {\n      return _loadUserFromCookies.apply(this, arguments);\n    }\n\n    function _loadUserFromCookies() {\n      _loadUserFromCookies = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var token, currentUser;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                token = Cookies.get(MERCURY_TOKEN);\n\n                if (!token) {\n                  _context.next = 7;\n                  break;\n                }\n\n                api.setToken(\"Bearer \".concat(token));\n                _context.next = 5;\n                return api.getMe();\n\n              case 5:\n                currentUser = _context.sent;\n                if (currentUser) setUser(currentUser);\n\n              case 7:\n                setLoading(false);\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _loadUserFromCookies.apply(this, arguments);\n    }\n\n    loadUserFromCookies();\n  }, []);\n\n  var login = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email, password) {\n      var loginResponse, currentUser;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return api.postLogin(email, password);\n\n            case 2:\n              loginResponse = _context2.sent;\n\n              if (!(!loginResponse || !loginResponse.token)) {\n                _context2.next = 5;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", null);\n\n            case 5:\n              Cookies.set(MERCURY_TOKEN, loginResponse.token, {\n                expires: 60\n              });\n              api.setToken(\"Bearer \".concat(loginResponse.token));\n              _context2.next = 9;\n              return api.getMe();\n\n            case 9:\n              currentUser = _context2.sent;\n              if (currentUser) setUser(currentUser);\n              return _context2.abrupt(\"return\", currentUser);\n\n            case 12:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function login(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var logout = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              Cookies.remove(MERCURY_TOKEN);\n              setUser(null);\n              _context3.next = 4;\n              return router.push('/login');\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function logout() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(AuthContext.Provider, {\n    value: {\n      user: user,\n      loading: loading,\n      login: login,\n      logout: logout,\n      isAuthenticated: !!user\n    }\n  }, children);\n}\n\n_s(AuthProvider, \"BbLp2f70vSKQbLuRmNWaNGLT/n4=\", false, function () {\n  return [useRouter];\n});\n\n_c = AuthProvider;\nexport function AuthRequired(Component) {\n  var _arguments = arguments,\n      _s2 = $RefreshSig$();\n\n  return _s2(function () {\n    _s2();\n\n    var router = useRouter();\n\n    var _useAuth = useAuth(),\n        isAuthenticated = _useAuth.isAuthenticated,\n        loading = _useAuth.loading;\n\n    useEffect(function () {\n      if (!isAuthenticated && !loading) router.push('/login');\n    }, [loading, isAuthenticated]);\n    return loading ? __jsx(Segment, {\n      style: {\n        height: '100vh'\n      },\n      loading: true\n    }) : __jsx(Component, _arguments);\n  }, \"gWJ89pc545Cl+2Ljpu5b9kbtsR0=\", false, function () {\n    return [useRouter, useAuth];\n  });\n}\n_c2 = AuthRequired;\nexport function useAuth() {\n  _s3();\n\n  return useContext(AuthContext);\n}\n\n_s3(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"AuthProvider\");\n$RefreshReg$(_c2, \"AuthRequired\");","map":{"version":3,"sources":["C:/Users/ryanj/Documents/mercury/components/authProvider.js"],"names":["React","createContext","useContext","useEffect","useState","useRouter","Cookies","api","Segment","MERCURY_TOKEN","AuthContext","AuthProvider","children","router","user","setUser","loading","setLoading","loadUserFromCookies","token","get","setToken","getMe","currentUser","login","email","password","postLogin","loginResponse","set","expires","logout","remove","push","isAuthenticated","AuthRequired","Component","useAuth","height","arguments"],"mappings":"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","sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react'\r\nimport { useRouter } from 'next/router'\r\nimport Cookies from 'js-cookie'\r\nimport * as api from '../util/mercuryService'\r\nimport { Segment } from 'semantic-ui-react'\r\n\r\nconst MERCURY_TOKEN = 'mercury-token'\r\n\r\nconst AuthContext = createContext({})\r\n\r\nexport function AuthProvider({ children }) {\r\n  const router = useRouter()\r\n  const [user, setUser] = useState(null)\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  useEffect(() => {\r\n    async function loadUserFromCookies() {\r\n      const token = Cookies.get(MERCURY_TOKEN)\r\n\r\n      if (token) {\r\n        api.setToken(`Bearer ${token}`)\r\n\r\n        const currentUser = await api.getMe()\r\n        if (currentUser) setUser(currentUser)\r\n      }\r\n\r\n      setLoading(false)\r\n    }\r\n\r\n    loadUserFromCookies()\r\n  }, [])\r\n\r\n  const login = async (email, password) => {\r\n    const loginResponse = await api.postLogin(email, password)\r\n    if (!loginResponse || !loginResponse.token) return null\r\n\r\n    Cookies.set(MERCURY_TOKEN, loginResponse.token, { expires: 60 })\r\n    api.setToken(`Bearer ${loginResponse.token}`)\r\n\r\n    const currentUser = await api.getMe()\r\n    if (currentUser) setUser(currentUser)\r\n\r\n    return currentUser\r\n  }\r\n\r\n  const logout = async () => {\r\n    Cookies.remove(MERCURY_TOKEN)\r\n    setUser(null)\r\n    await router.push('/login')\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{ user, loading, login, logout, isAuthenticated: !!user }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  )\r\n}\r\n\r\nexport function AuthRequired(Component) {\r\n  return () => {\r\n    const router = useRouter()\r\n    const { isAuthenticated, loading } = useAuth()\r\n\r\n    useEffect(() => {\r\n      if (!isAuthenticated && !loading) router.push('/login')\r\n    }, [loading, isAuthenticated])\r\n\r\n    return loading ? (\r\n      <Segment style={{ height: '100vh' }} loading />\r\n    ) : (\r\n      <Component {...arguments} />\r\n    )\r\n  }\r\n}\r\n\r\nexport function useAuth() {\r\n  return useContext(AuthContext)\r\n}\r\n"]},"metadata":{},"sourceType":"module"}