{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport { withRouter } from 'next/router';\nimport dynamic from 'next/dynamic';\nimport Layout from '../../components/layout';\nimport { Button, Accordion, List, Icon, Label } from 'semantic-ui-react';\nimport { AuthRequired } from '../../components/authProvider';\nimport Queue from '../../components/queue/queue';\nimport * as api from '../../util/mercuryService';\nimport CreateGroupModal from '../../components/createGroupModal';\nimport UserInviteModal from '../../components/invite/userInviteModal';\nimport { EventEmitter } from '../../components/util/EventEmitter';\nimport FeedbackModal from '../../components/feedbackModal';\nimport StudentWebSocketClient from '../../util/studentWebSocket';\nimport TAWebSocketClient from '../../util/taWebSocket';\nimport ReceiveInviteModal from '../../components/invite/receiveInviteModal';\nimport { NotificationContainer, NotificationManager } from 'react-notifications';\nimport GroupJoinRequestModal from '../../components/invite/groupJoinRequestModal';\nimport WaitingForRequestApprovalModal from '../../components/invite/WaitingForRequestApprovalModal';\nimport WaitingForNewLeaderModal from '../../components/WaitingForNewLeaderModal';\nimport AccessDeniedModal from '../../components/accessDeniedModal';\nimport OfficeAccessModal from '../../components/officeAccessModal';\nimport { confirmAlert } from 'react-confirm-alert'; // Import\n\nvar ScreenContainer = dynamic(_c = function _c() {\n  return import('../../components/screenContainer');\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('../../components/screenContainer')];\n    },\n    modules: ['../../components/screenContainer']\n  }\n});\n_c2 = ScreenContainer;\nvar CreateDiscussionModal = dynamic(_c3 = function _c3() {\n  return import('../../components/createDiscussionModal');\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('../../components/createDiscussionModal')];\n    },\n    modules: ['../../components/createDiscussionModal']\n  }\n});\n_c4 = CreateDiscussionModal;\n\nvar ClassPage = /*#__PURE__*/function (_Component) {\n  _inherits(ClassPage, _Component);\n\n  var _super = _createSuper(ClassPage);\n\n  function ClassPage(props) {\n    var _this;\n\n    _classCallCheck(this, ClassPage);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"fetchAllGroups\", function () {\n      api.getGroups(_this.state.currentClass.id).then(function (groups) {\n        return _this.setState({\n          allGroups: groups\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"leaveGroupForTAOffice\", function () {\n      api.deleteGroupUser(_this.state.currentClass.id, _this.state.currentGroup.id, _this.user.id)[\"catch\"](console.error);\n\n      _this.fetchAllGroups();\n\n      EventEmitter.publish('classGroupSetChanged', _this.classId);\n      EventEmitter.publish('userLeaveGroup', _this.state.currentGroup);\n\n      _this.setState({\n        vonageCred: null,\n        currentGroup: {\n          id: '',\n          name: ''\n        },\n        withTa: true\n      });\n\n      EventEmitter.publish('currentGroupChange', {\n        id: '',\n        name: ''\n      });\n      localStorage.removeItem('lastCallEntered');\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"leaveGroup\", function () {\n      api.deleteGroupUser(_this.state.currentClass.id, _this.state.currentGroup.id, _this.user.id)[\"catch\"](console.error);\n\n      _this.fetchAllGroups(); // re-fetch current groups\n\n\n      EventEmitter.publish('classGroupSetChanged', _this.classId); // tell everyone to re-fetch their groups in the class\n\n      EventEmitter.publish('userLeaveGroup', _this.state.currentGroup); // notify backend that you have left the call\n\n      _this.setState({\n        // leave the call\n        vonageCred: null,\n        currentGroup: {\n          id: '',\n          name: ''\n        },\n        withTa: false\n      });\n\n      EventEmitter.publish('currentGroupChange', {\n        id: '',\n        name: ''\n      }); // change current group\n\n      EventEmitter.publish('callOver', _this.classId); // signal call over, which triggers feedback modal and curr student update on the queue\n\n      localStorage.removeItem('lastCallEntered');\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleBack\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _this.props.router.push('/calendar');\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSelectGroup\", /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(group) {\n        var role, currGroup, UserId, id;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                role = _this.state.currentClass.role;\n\n                if (!(group.type === 'office' || role === 'Professor' || group.type === 'discussion')) {\n                  _context2.next = 4;\n                  break;\n                }\n\n                // you are popped off the waiting queue or you are a TA\n                _this.joinGroup(group);\n\n                return _context2.abrupt(\"return\");\n\n              case 4:\n                _context2.next = 6;\n                return api.getGroupByID(_this.classId, group.id);\n\n              case 6:\n                currGroup = _context2.sent;\n                UserId = currGroup.UserId;\n                id = _this.user.id;\n\n                if (UserId === id) {\n                  // you are the leader of the group, no need for authentication\n                  _this.joinGroup(group);\n                } else {\n                  /**\r\n                   * Ping group leader to let you into the group\r\n                   */\n                  EventEmitter.publish('activateWaitingForRequestApprovalModal', group);\n                  EventEmitter.publish('requestJoinGroup', {\n                    userId: id,\n                    group: group\n                  });\n                }\n\n              case 10:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCreateTAOffice\", /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(group) {\n        var groupData;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(_this.state.allGroups.filter(function (check) {\n                  return check.name === group.name;\n                }).length === 0)) {\n                  _context3.next = 8;\n                  break;\n                }\n\n                _context3.next = 3;\n                return api.postGroup(group.classId, group.name, group.type, group.userId);\n\n              case 3:\n                groupData = _context3.sent;\n                EventEmitter.publish('classGroupSetChanged', _this.classId);\n\n                _this.fetchAllGroups();\n\n                _context3.next = 8;\n                break;\n\n              case 8:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCreateGroup\", /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(group) {\n        var groupData;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return api.postGroup(_this.classId, group.name, group.type, _this.user.id);\n\n              case 2:\n                groupData = _context4.sent;\n                EventEmitter.publish('classGroupSetChanged', _this.classId);\n                _context4.next = 6;\n                return _this.handleSelectGroup(groupData);\n\n              case 6:\n                _this.fetchAllGroups();\n\n              case 7:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      return function (_x3) {\n        return _ref4.apply(this, arguments);\n      };\n    }());\n\n    _this.state = {\n      withTa: false,\n      clicked: 'none',\n      currentGroup: {\n        id: '',\n        name: ''\n      },\n      currentClass: {\n        id: '',\n        name: '',\n        //groups: [],\n        users: [],\n        role: 'Student'\n      },\n      vonageCred: null,\n      isMounted: false,\n      allGroups: [],\n      toRejoin: false // activate rejoin option confirm alert\n\n    };\n\n    _this.defineEventEmitterCallbacks();\n\n    return _this;\n  }\n\n  _createClass(ClassPage, [{\n    key: \"joinGroup\",\n    value: function joinGroup(group) {\n      var _this2 = this;\n\n      api.postGroupToken(this.classId, group.id).then(function (_ref5) {\n        var token = _ref5.token;\n\n        if (_this2.state.currentGroup.id !== '') {\n          //the user is currently in a call, leave the call first\n          if (group.type === 'office') {\n            // this case only happens when the user is leaving a private group for the TA office\n            // do not trigger the callOver event in this case\n            _this2.leaveGroupForTAOffice();\n          } else {\n            _this2.leaveGroup();\n          }\n        }\n\n        _this2.setState({\n          vonageCred: {\n            sessionId: group.sessionId,\n            token: token\n          },\n          currentGroup: group\n        }, function () {\n          EventEmitter.publish('userJoinGroup', {\n            groupId: group.id,\n            userId: _this2.user.id,\n            groupType: group.type\n          });\n          EventEmitter.publish('currentGroupChange', group); // log the credentials of your most recent call\n\n          localStorage.setItem('lastCallEntered', JSON.stringify(group));\n        });\n      }).then(function () {\n        api.postJoinGroup(_this2.classId, group.id, _this2.user.email).then(function () {\n          return EventEmitter.publish('classGroupSetChanged', _this2.classId);\n        });\n      }).then(function () {\n        _this2.fetchAllGroups();\n      })[\"catch\"](console.error);\n    }\n  }, {\n    key: \"defineEventEmitterCallbacks\",\n    value: function defineEventEmitterCallbacks() {\n      var _this3 = this;\n\n      EventEmitter.subscribe('clearLeftSide', function () {\n        _this3.setState({\n          withTa: true\n        });\n      });\n      EventEmitter.subscribe('joinPrivateGroupOnApproval', function (group) {\n        EventEmitter.publish('removeWaitingForRequestApprovalModal');\n\n        _this3.joinGroup(group);\n      });\n      EventEmitter.subscribe('notifyJoinRequestDeclined', function (group) {\n        NotificationManager.info(\"Your Request To Join \".concat(group.name, \" Was Declined\"));\n        EventEmitter.publish('removeWaitingForRequestApprovalModal');\n      });\n      EventEmitter.subscribe('fetchGroups', function () {\n        _this3.fetchAllGroups();\n      });\n      EventEmitter.subscribe('createNotification', function (msg) {\n        NotificationManager.info(msg);\n      });\n      EventEmitter.subscribe('createTAOffice', function (classUser) {\n        _this3.fetchAllGroups();\n\n        _this3.handleCreateTAOffice({\n          classId: classUser.classId,\n          name: _this3.user.firstName + ' ' + _this3.user.lastName + \"'s Office\",\n          type: 'office',\n          userId: classUser.userId\n        });\n      });\n      EventEmitter.subscribe('leaveCallOnError', function () {\n        _this3.leaveGroup();\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this4 = this;\n\n      var classId = this.props.router.query.classId;\n      if (!classId) return;\n      this.classId = Number(classId);\n      api.getMe().then(function (meData) {\n        _this4.user = meData;\n      }).then(function () {\n        return api.getClass(_this4.classId);\n      }).then(function (c) {\n        var userRole = c.users.find(function (u) {\n          return u.id === _this4.user.id;\n        });\n        if (!userRole) _this4.props.router.push('/calendar');\n        var role = userRole.role;\n        var toRejoin = false;\n        /**\r\n         * Start the appropriate web socket handler depending on the user role\r\n         */\n\n        if (role === 'Student') {\n          /**\r\n           * Start student web socket handler\r\n           */\n          new StudentWebSocketClient().start({\n            me: _this4.user,\n            courseId: _this4.classId\n          });\n        } else {\n          /**\r\n           * Start TA web socket handler\r\n           */\n          new TAWebSocketClient().start({\n            me: _this4.user,\n            courseId: _this4.classId,\n            onJoin: _this4.handleSelectGroup\n          });\n\n          if (localStorage.getItem('lastCallEntered')) {\n            // if you were previously involved in a call, please allow rejoin option\n            toRejoin = true;\n          }\n        }\n\n        _this4.setState({\n          currentClass: _objectSpread(_objectSpread({}, c), {}, {\n            role: userRole.role\n          }),\n          toRejoin: toRejoin\n        });\n\n        EventEmitter.publish('allOtherUsersInClass', _this4.state.currentClass.users.filter(function (user) {\n          return user.id !== _this4.user.id && user.role === role;\n        }));\n        EventEmitter.publish('me', _this4.user);\n      }).then(function () {\n        _this4.fetchAllGroups();\n      }).then(function () {\n        setInterval(_this4.fetchAllGroups, 10000);\n      }).then(function () {\n        _this4.setState({\n          isMounted: true\n        });\n      })[\"catch\"](console.error);\n    }\n  }, {\n    key: \"getButtonToDisplay\",\n    value: function getButtonToDisplay() {\n      var _this5 = this;\n\n      return this.state.currentClass.role === 'Student' ? __jsx(CreateGroupModal, {\n        onCreate: this.handleCreateGroup\n      }) : this.state.clicked === 'none' ? __jsx(Button, {\n        color: \"teal\",\n        content: \"Modify Discussions\",\n        fluid: true,\n        style: {\n          fontSize: '1vw'\n        },\n        onClick: function onClick() {\n          _this5.setState({\n            clicked: 'inline'\n          });\n        }\n      }) : __jsx(React.Fragment, null, __jsx(CreateDiscussionModal, {\n        id: \"createDiscussionModal\",\n        onCreate: this.handleCreateGroup\n      }), __jsx(Button, {\n        color: \"red\",\n        content: \"Done\",\n        fluid: true,\n        style: {\n          fontSize: '1vw',\n          marginTop: '2%'\n        },\n        onClick: function onClick() {\n          _this5.setState({\n            clicked: 'none'\n          });\n        }\n      }));\n    }\n  }, {\n    key: \"getDeleteButton\",\n    value: function getDeleteButton(group) {\n      var _this6 = this;\n\n      return __jsx(Button, {\n        id: \"deletebutton\".concat(group.id),\n        compact: true,\n        icon: true,\n        size: \"mini\",\n        floated: \"right\",\n        style: {\n          display: \"\".concat(this.state.clicked),\n          fontSize: '.6vw',\n          textAlign: 'center',\n          width: '10%',\n          marginBottom: '2%',\n          minWidth: '10px',\n          backgroundColor: 'transparent'\n        },\n        onClick: function onClick() {\n          return api.deleteGroup(_this6.classId, group.id).then(function () {\n            _this6.fetchAllGroups();\n\n            EventEmitter.publish('classGroupSetChanged', _this6.classId);\n          });\n        }\n      }, __jsx(Icon, {\n        name: \"delete\",\n        color: \"red\"\n      }));\n    }\n  }, {\n    key: \"showInviteButton\",\n    value: function showInviteButton(group) {\n      var plusIcon = __jsx(List.Icon, {\n        name: \"user plus\",\n        onClick: function onClick() {\n          EventEmitter.publish('openInviteModal', true);\n        }\n      });\n\n      var noPlusIcon = __jsx(\"div\", null);\n\n      return this.state.currentGroup.id == group.id && this.state.vonageCred !== null ? plusIcon : noPlusIcon;\n    }\n  }, {\n    key: \"getListItemStyle\",\n    value: function getListItemStyle(group) {\n      var unClickedGroupsStyle = {\n        fontSize: '.8vw',\n        textAlign: 'left',\n        width: '80%',\n        marginBottom: '2%',\n        minWidth: '41px',\n        display: 'inline-block'\n      };\n      var clickedGroupsStyle = {\n        fontSize: '.8vw',\n        textAlign: 'left',\n        width: '80%',\n        marginBottom: '2%',\n        minWidth: '41px',\n        background: '#e0e1e2',\n        borderRadius: 10,\n        borderWidth: 1,\n        borderColor: '#fff',\n        display: 'inline-block'\n      };\n      return this.state.currentGroup.id == group.id && this.state.vonageCred !== null ? clickedGroupsStyle : unClickedGroupsStyle;\n    }\n  }, {\n    key: \"showOffice\",\n    value: function showOffice() {\n      var _this7 = this;\n\n      return __jsx(\"div\", {\n        style: {\n          paddingLeft: 20\n        }\n      }, __jsx(List, {\n        relaxed: true,\n        selection: true,\n        verticalAlign: \"middle\"\n      }, this.state.allGroups.filter(function (group) {\n        return group.type === 'office';\n      }).map(function (group) {\n        return __jsx(List.Item, {\n          key: \"\".concat(group.name),\n          onClick: function onClick() {\n            if (_this7.state.currentClass.role === 'Student') {\n              EventEmitter.publish('openOfficeAccessModal', true);\n            } else if (_this7.state.currentGroup.id !== group.id) {\n              _this7.handleSelectGroup(group);\n            }\n          },\n          style: _this7.getListItemStyle(group)\n        }, __jsx(List.Icon, {\n          name: \"graduation cap\"\n        }), __jsx(List.Content, null, __jsx(List.Header, {\n          as: \"a\"\n        }, group.name + ' (' + group.users.length + ')')), _this7.showInviteButton(group));\n      })));\n    }\n  }, {\n    key: \"leftDisplay\",\n    value: function leftDisplay() {\n      var _this8 = this;\n\n      return this.state.withTa === false ? __jsx(\"div\", {\n        style: {\n          height: '100%',\n          marginLeft: '2.5%'\n        }\n      }, __jsx(Button.Group, {\n        size: \"huge\",\n        style: {\n          marginBottom: 12,\n          width: '100%'\n        },\n        fluid: true\n      }, __jsx(Button, {\n        compact: true,\n        icon: \"angle left\",\n        content: this.state.currentClass.name,\n        style: {\n          fontSize: '1.5vw',\n          textAlign: 'left',\n          width: '75%',\n          marginBottom: '2%',\n          minWidth: '41px'\n        },\n        onClick: this.handleBack\n      })), this.showOffice(), __jsx(Accordion, {\n        fluid: true,\n        exclusive: false,\n        defaultActiveIndex: [0, 1],\n        style: {\n          fontSize: '1vw',\n          textAlign: 'left',\n          width: '100%',\n          marginBottom: '2%',\n          minWidth: '41px'\n        },\n        panels: [{\n          key: 'discussions',\n          title: 'Discussions',\n          content: {\n            content: __jsx(\"div\", {\n              style: {\n                paddingLeft: 20,\n                height: 200,\n                overflow: 'auto'\n              }\n            }, __jsx(List, {\n              relaxed: true,\n              selection: true\n            }, this.state.allGroups.filter(function (group) {\n              return group.type === 'discussion';\n            }).map(function (group) {\n              return __jsx(React.Fragment, null, __jsx(List.Item, {\n                key: \"discussion_\".concat(group.id),\n                onClick: function onClick() {\n                  if (_this8.state.currentGroup.id !== group.id) {\n                    _this8.handleSelectGroup(group);\n                  }\n                },\n                style: _this8.getListItemStyle(group)\n              }, __jsx(List.Icon, {\n                name: \"sound\"\n              }), __jsx(List.Content, null, __jsx(List.Header, {\n                as: \"a\"\n              }, group.name + ' (' + group.users.length + ')')), _this8.showInviteButton(group)), _this8.getDeleteButton(group));\n            })))\n          }\n        }, {\n          key: 'private-groups',\n          title: 'Private Groups',\n          content: {\n            content: __jsx(\"div\", {\n              style: {\n                paddingLeft: 20,\n                height: 200,\n                overflow: 'auto'\n              }\n            }, __jsx(List, {\n              relaxed: true,\n              selection: true\n            }, this.state.allGroups.filter(function (group) {\n              return group.type === 'group';\n            }).map(function (group) {\n              return __jsx(List.Item, {\n                key: \"private_group_\".concat(group.id),\n                onClick: function onClick() {\n                  if (_this8.state.currentGroup.id !== group.id) {\n                    _this8.handleSelectGroup(group);\n                  }\n                },\n                style: _this8.getListItemStyle(group)\n              }, __jsx(List.Icon, {\n                name: \"lock\"\n              }), __jsx(List.Content, null, __jsx(List.Header, {\n                as: \"a\"\n              }, group.name + ' (' + group.users.length + ')')), _this8.showInviteButton(group));\n            })))\n          }\n        }]\n      }), __jsx(\"div\", {\n        style: {\n          position: 'absolute',\n          width: 'calc(100% - 38px)',\n          bottom: 14\n        }\n      }, this.getButtonToDisplay())) : __jsx(\"div\", {\n        style: {\n          height: '100%',\n          marginLeft: '2.5%'\n        }\n      }, __jsx(Button.Group, {\n        size: \"huge\",\n        style: {\n          marginBottom: 12,\n          width: '100%'\n        },\n        fluid: true\n      }, __jsx(Button, {\n        compact: true,\n        content: this.state.currentClass.name,\n        style: {\n          fontSize: '1.5vw',\n          textAlign: 'left',\n          width: '75%',\n          marginBottom: '2%',\n          minWidth: '41px'\n        }\n      })), __jsx(Label, {\n        size: \"massive\",\n        style: {\n          fontSize: '1vw',\n          textAlign: 'center',\n          width: '100%',\n          marginBottom: '4%',\n          minWidth: '41px'\n        }\n      }, \"You are currently in a TA's office. Please click the leave call button to join another group.\"));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this9 = this;\n\n      if (!this.state.isMounted) {\n        return null;\n      }\n\n      if (this.state.toRejoin) {\n        var group = JSON.parse(localStorage.getItem('lastCallEntered'));\n        confirmAlert({\n          title: 'Rejoin Call',\n          message: 'It appears you did not leave your last call. Would you like to rejoin it?',\n          buttons: [{\n            label: 'Yes',\n            onClick: function onClick() {\n              _this9.joinGroup(group);\n\n              _this9.setState({\n                toRejoin: false\n              }, function () {\n                EventEmitter.publish('TARejoinCall');\n              });\n            }\n          }, {\n            label: 'No',\n            onClick: function onClick() {\n              localStorage.removeItem('lastCallEntered');\n\n              _this9.setState({\n                toRejoin: false\n              });\n            }\n          }]\n        });\n      }\n\n      return __jsx(Layout, {\n        left: this.leftDisplay(),\n        right: __jsx(Queue, {\n          onJoin: this.handleSelectGroup\n        })\n      }, this.state.vonageCred && __jsx(ScreenContainer, {\n        style: {\n          width: '100%',\n          maxHeight: '75vh'\n        },\n        sessionId: this.state.vonageCred.sessionId,\n        token: this.state.vonageCred.token,\n        onLeave: this.leaveGroup,\n        name: this.user.firstName + ' ' + this.user.lastName\n      }), __jsx(OfficeAccessModal, null), __jsx(AccessDeniedModal, null), __jsx(UserInviteModal, null), __jsx(FeedbackModal, null), __jsx(ReceiveInviteModal, {\n        onJoin: this.handleSelectGroup\n      }), __jsx(GroupJoinRequestModal, null), __jsx(WaitingForRequestApprovalModal, null), __jsx(NotificationContainer, null), __jsx(WaitingForNewLeaderModal, {\n        user: this.user.id\n      }));\n    }\n  }]);\n\n  return ClassPage;\n}(Component);\n\nexport default _c6 = AuthRequired(_c5 = withRouter(ClassPage));\n\nvar _c, _c2, _c3, _c4, _c5, _c6;\n\n$RefreshReg$(_c, \"ScreenContainer$dynamic\");\n$RefreshReg$(_c2, \"ScreenContainer\");\n$RefreshReg$(_c3, \"CreateDiscussionModal$dynamic\");\n$RefreshReg$(_c4, \"CreateDiscussionModal\");\n$RefreshReg$(_c5, \"%default%$AuthRequired\");\n$RefreshReg$(_c6, \"%default%\");","map":{"version":3,"sources":["C:/Users/ryanj/Documents/mercury/pages/classes/[classId].js"],"names":["React","Component","withRouter","dynamic","Layout","Button","Accordion","List","Icon","Label","AuthRequired","Queue","api","CreateGroupModal","UserInviteModal","EventEmitter","FeedbackModal","StudentWebSocketClient","TAWebSocketClient","ReceiveInviteModal","NotificationContainer","NotificationManager","GroupJoinRequestModal","WaitingForRequestApprovalModal","WaitingForNewLeaderModal","AccessDeniedModal","OfficeAccessModal","confirmAlert","ScreenContainer","ssr","CreateDiscussionModal","ClassPage","props","getGroups","state","currentClass","id","then","groups","setState","allGroups","deleteGroupUser","currentGroup","user","console","error","fetchAllGroups","publish","classId","vonageCred","name","withTa","localStorage","removeItem","router","push","group","role","type","joinGroup","getGroupByID","currGroup","UserId","userId","filter","check","length","postGroup","groupData","handleSelectGroup","clicked","users","isMounted","toRejoin","defineEventEmitterCallbacks","postGroupToken","token","leaveGroupForTAOffice","leaveGroup","sessionId","groupId","groupType","setItem","JSON","stringify","postJoinGroup","email","subscribe","info","msg","classUser","handleCreateTAOffice","firstName","lastName","query","Number","getMe","meData","getClass","c","userRole","find","u","start","me","courseId","onJoin","getItem","setInterval","handleCreateGroup","fontSize","marginTop","display","textAlign","width","marginBottom","minWidth","backgroundColor","deleteGroup","plusIcon","noPlusIcon","unClickedGroupsStyle","clickedGroupsStyle","background","borderRadius","borderWidth","borderColor","paddingLeft","map","getListItemStyle","showInviteButton","height","marginLeft","handleBack","showOffice","key","title","content","overflow","getDeleteButton","position","bottom","getButtonToDisplay","parse","message","buttons","label","onClick","leftDisplay","maxHeight"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport { withRouter } from 'next/router'\r\nimport dynamic from 'next/dynamic'\r\nimport Layout from '../../components/layout'\r\nimport { Button, Accordion, List, Icon, Label } from 'semantic-ui-react'\r\nimport { AuthRequired } from '../../components/authProvider'\r\nimport Queue from '../../components/queue/queue'\r\nimport * as api from '../../util/mercuryService'\r\nimport CreateGroupModal from '../../components/createGroupModal'\r\nimport UserInviteModal from '../../components/invite/userInviteModal'\r\nimport { EventEmitter } from '../../components/util/EventEmitter'\r\nimport FeedbackModal from '../../components/feedbackModal'\r\nimport StudentWebSocketClient from '../../util/studentWebSocket'\r\nimport TAWebSocketClient from '../../util/taWebSocket'\r\nimport ReceiveInviteModal from '../../components/invite/receiveInviteModal'\r\nimport { NotificationContainer, NotificationManager } from 'react-notifications'\r\nimport GroupJoinRequestModal from '../../components/invite/groupJoinRequestModal'\r\nimport WaitingForRequestApprovalModal from '../../components/invite/WaitingForRequestApprovalModal'\r\nimport WaitingForNewLeaderModal from '../../components/WaitingForNewLeaderModal'\r\nimport AccessDeniedModal from '../../components/accessDeniedModal'\r\nimport OfficeAccessModal from '../../components/officeAccessModal'\r\nimport { confirmAlert } from 'react-confirm-alert' // Import\r\n\r\nconst ScreenContainer = dynamic(\r\n  () => import('../../components/screenContainer'),\r\n  {\r\n    ssr: false,\r\n  }\r\n)\r\n\r\nconst CreateDiscussionModal = dynamic(\r\n  () => import('../../components/createDiscussionModal'),\r\n  {\r\n    ssr: false,\r\n  }\r\n)\r\n\r\nclass ClassPage extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      withTa: false,\r\n      clicked: 'none',\r\n      currentGroup: { id: '', name: '' },\r\n      currentClass: {\r\n        id: '',\r\n        name: '',\r\n        //groups: [],\r\n        users: [],\r\n        role: 'Student',\r\n      },\r\n      vonageCred: null,\r\n      isMounted: false,\r\n      allGroups: [],\r\n      toRejoin: false, // activate rejoin option confirm alert\r\n    }\r\n\r\n    this.defineEventEmitterCallbacks()\r\n  }\r\n\r\n  fetchAllGroups = () => {\r\n    api\r\n      .getGroups(this.state.currentClass.id)\r\n      .then((groups) => this.setState({ allGroups: groups }))\r\n  }\r\n\r\n  joinGroup(group) {\r\n    api\r\n      .postGroupToken(this.classId, group.id)\r\n      .then(({ token }) => {\r\n        if (this.state.currentGroup.id !== '') {\r\n          //the user is currently in a call, leave the call first\r\n\r\n          if (group.type === 'office') {\r\n            // this case only happens when the user is leaving a private group for the TA office\r\n            // do not trigger the callOver event in this case\r\n            this.leaveGroupForTAOffice()\r\n          } else {\r\n            this.leaveGroup()\r\n          }\r\n        }\r\n\r\n        this.setState(\r\n          {\r\n            vonageCred: { sessionId: group.sessionId, token },\r\n            currentGroup: group,\r\n          },\r\n          () => {\r\n            EventEmitter.publish('userJoinGroup', {\r\n              groupId: group.id,\r\n              userId: this.user.id,\r\n              groupType: group.type,\r\n            })\r\n            EventEmitter.publish('currentGroupChange', group)\r\n\r\n            // log the credentials of your most recent call\r\n            localStorage.setItem('lastCallEntered', JSON.stringify(group))\r\n          }\r\n        )\r\n      })\r\n      .then(() => {\r\n        api\r\n          .postJoinGroup(this.classId, group.id, this.user.email)\r\n          .then(() =>\r\n            EventEmitter.publish('classGroupSetChanged', this.classId)\r\n          )\r\n      })\r\n      .then(() => {\r\n        this.fetchAllGroups()\r\n      })\r\n      .catch(console.error)\r\n  }\r\n\r\n  leaveGroupForTAOffice = () => {\r\n    api\r\n      .deleteGroupUser(\r\n        this.state.currentClass.id,\r\n        this.state.currentGroup.id,\r\n        this.user.id\r\n      )\r\n      .catch(console.error)\r\n\r\n    this.fetchAllGroups()\r\n    EventEmitter.publish('classGroupSetChanged', this.classId)\r\n    EventEmitter.publish('userLeaveGroup', this.state.currentGroup)\r\n    this.setState({\r\n      vonageCred: null,\r\n      currentGroup: { id: '', name: '' },\r\n      withTa: true,\r\n    })\r\n    EventEmitter.publish('currentGroupChange', { id: '', name: '' })\r\n    localStorage.removeItem('lastCallEntered')\r\n  }\r\n\r\n  leaveGroup = () => {\r\n    api\r\n      .deleteGroupUser(\r\n        this.state.currentClass.id,\r\n        this.state.currentGroup.id,\r\n        this.user.id\r\n      )\r\n      .catch(console.error)\r\n\r\n    this.fetchAllGroups() // re-fetch current groups\r\n    EventEmitter.publish('classGroupSetChanged', this.classId) // tell everyone to re-fetch their groups in the class\r\n    EventEmitter.publish('userLeaveGroup', this.state.currentGroup) // notify backend that you have left the call\r\n\r\n    this.setState({\r\n      // leave the call\r\n      vonageCred: null,\r\n      currentGroup: { id: '', name: '' },\r\n      withTa: false,\r\n    })\r\n\r\n    EventEmitter.publish('currentGroupChange', { id: '', name: '' }) // change current group\r\n    EventEmitter.publish('callOver', this.classId) // signal call over, which triggers feedback modal and curr student update on the queue\r\n    localStorage.removeItem('lastCallEntered')\r\n  }\r\n\r\n  defineEventEmitterCallbacks() {\r\n    EventEmitter.subscribe('clearLeftSide', () => {\r\n      this.setState({ withTa: true })\r\n    })\r\n\r\n    EventEmitter.subscribe('joinPrivateGroupOnApproval', (group) => {\r\n      EventEmitter.publish('removeWaitingForRequestApprovalModal')\r\n      this.joinGroup(group)\r\n    })\r\n\r\n    EventEmitter.subscribe('notifyJoinRequestDeclined', (group) => {\r\n      NotificationManager.info(\r\n        `Your Request To Join ${group.name} Was Declined`\r\n      )\r\n      EventEmitter.publish('removeWaitingForRequestApprovalModal')\r\n    })\r\n\r\n    EventEmitter.subscribe('fetchGroups', () => {\r\n      this.fetchAllGroups()\r\n    })\r\n\r\n    EventEmitter.subscribe('createNotification', (msg) => {\r\n      NotificationManager.info(msg)\r\n    })\r\n\r\n    EventEmitter.subscribe('createTAOffice', (classUser) => {\r\n      this.fetchAllGroups()\r\n      this.handleCreateTAOffice({\r\n        classId: classUser.classId,\r\n        name: this.user.firstName + ' ' + this.user.lastName + \"'s Office\",\r\n        type: 'office',\r\n        userId: classUser.userId,\r\n      })\r\n    })\r\n\r\n    EventEmitter.subscribe('leaveCallOnError', () => {\r\n      this.leaveGroup()\r\n    })\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { classId } = this.props.router.query\r\n    if (!classId) return\r\n    this.classId = Number(classId)\r\n\r\n    api\r\n      .getMe()\r\n      .then((meData) => {\r\n        this.user = meData\r\n      })\r\n\r\n      .then(() => api.getClass(this.classId))\r\n      .then((c) => {\r\n        const userRole = c.users.find((u) => u.id === this.user.id)\r\n        if (!userRole) this.props.router.push('/calendar')\r\n        const { role } = userRole\r\n\r\n        let toRejoin = false\r\n        /**\r\n         * Start the appropriate web socket handler depending on the user role\r\n         */\r\n\r\n        if (role === 'Student') {\r\n          /**\r\n           * Start student web socket handler\r\n           */\r\n\r\n          new StudentWebSocketClient().start({\r\n            me: this.user,\r\n            courseId: this.classId,\r\n          })\r\n        } else {\r\n          /**\r\n           * Start TA web socket handler\r\n           */\r\n\r\n          new TAWebSocketClient().start({\r\n            me: this.user,\r\n            courseId: this.classId,\r\n            onJoin: this.handleSelectGroup,\r\n          })\r\n\r\n          if (localStorage.getItem('lastCallEntered')) {\r\n            // if you were previously involved in a call, please allow rejoin option\r\n            toRejoin = true\r\n          }\r\n        }\r\n\r\n        this.setState({\r\n          currentClass: {\r\n            ...c,\r\n            role: userRole.role,\r\n          },\r\n          toRejoin,\r\n        })\r\n\r\n        EventEmitter.publish(\r\n          'allOtherUsersInClass',\r\n          this.state.currentClass.users.filter(\r\n            (user) => user.id !== this.user.id && user.role === role\r\n          )\r\n        )\r\n        EventEmitter.publish('me', this.user)\r\n      })\r\n      .then(() => {\r\n        this.fetchAllGroups()\r\n      })\r\n      .then(() => {\r\n        setInterval(this.fetchAllGroups, 10000)\r\n      })\r\n      .then(() => {\r\n        this.setState({ isMounted: true })\r\n      })\r\n      .catch(console.error)\r\n  }\r\n\r\n  handleBack = async () => {\r\n    await this.props.router.push('/calendar')\r\n  }\r\n\r\n  handleSelectGroup = async (group) => {\r\n    const { role } = this.state.currentClass\r\n\r\n    if (\r\n      group.type === 'office' ||\r\n      role === 'Professor' ||\r\n      group.type === 'discussion'\r\n    ) {\r\n      // you are popped off the waiting queue or you are a TA\r\n      this.joinGroup(group)\r\n      return\r\n    }\r\n\r\n    /**\r\n     * First, check if you are the leader of the group\r\n     */\r\n\r\n    const currGroup = await api.getGroupByID(this.classId, group.id)\r\n    const { UserId } = currGroup\r\n    const { id } = this.user\r\n\r\n    if (UserId === id) {\r\n      // you are the leader of the group, no need for authentication\r\n      this.joinGroup(group)\r\n    } else {\r\n      /**\r\n       * Ping group leader to let you into the group\r\n       */\r\n      EventEmitter.publish('activateWaitingForRequestApprovalModal', group)\r\n      EventEmitter.publish('requestJoinGroup', {\r\n        userId: id,\r\n        group: group,\r\n      })\r\n    }\r\n  }\r\n\r\n  getButtonToDisplay() {\r\n    return this.state.currentClass.role === 'Student' ? (\r\n      <CreateGroupModal onCreate={this.handleCreateGroup} />\r\n    ) : this.state.clicked === 'none' ? (\r\n      <Button\r\n        color=\"teal\"\r\n        content=\"Modify Discussions\"\r\n        fluid\r\n        style={{ fontSize: '1vw' }}\r\n        onClick={() => {\r\n          this.setState({ clicked: 'inline' })\r\n        }}\r\n      />\r\n    ) : (\r\n      <>\r\n        <CreateDiscussionModal\r\n          id=\"createDiscussionModal\"\r\n          onCreate={this.handleCreateGroup}\r\n        />\r\n        <Button\r\n          color=\"red\"\r\n          content=\"Done\"\r\n          fluid\r\n          style={{ fontSize: '1vw', marginTop: '2%' }}\r\n          onClick={() => {\r\n            this.setState({ clicked: 'none' })\r\n          }}\r\n        />\r\n      </>\r\n    )\r\n  }\r\n\r\n  getDeleteButton(group) {\r\n    return (\r\n      <Button\r\n        id={`deletebutton${group.id}`}\r\n        compact\r\n        icon\r\n        size=\"mini\"\r\n        floated=\"right\"\r\n        style={{\r\n          display: `${this.state.clicked}`,\r\n          fontSize: '.6vw',\r\n          textAlign: 'center',\r\n          width: '10%',\r\n          marginBottom: '2%',\r\n          minWidth: '10px',\r\n          backgroundColor: 'transparent',\r\n        }}\r\n        onClick={() =>\r\n          api.deleteGroup(this.classId, group.id).then(() => {\r\n            this.fetchAllGroups()\r\n            EventEmitter.publish('classGroupSetChanged', this.classId)\r\n          })\r\n        }\r\n      >\r\n        <Icon name=\"delete\" color=\"red\" />\r\n      </Button>\r\n    )\r\n  }\r\n\r\n  handleCreateTAOffice = async (group) => {\r\n    if (\r\n      this.state.allGroups.filter((check) => check.name === group.name)\r\n        .length === 0\r\n    ) {\r\n      const groupData = await api.postGroup(\r\n        group.classId,\r\n        group.name,\r\n        group.type,\r\n        group.userId\r\n      )\r\n      EventEmitter.publish('classGroupSetChanged', this.classId)\r\n      this.fetchAllGroups()\r\n    } else {\r\n    }\r\n  }\r\n\r\n  handleCreateGroup = async (group) => {\r\n    const groupData = await api.postGroup(\r\n      this.classId,\r\n      group.name,\r\n      group.type,\r\n      this.user.id\r\n    )\r\n    EventEmitter.publish('classGroupSetChanged', this.classId)\r\n    await this.handleSelectGroup(groupData)\r\n    this.fetchAllGroups()\r\n  }\r\n\r\n  showInviteButton(group) {\r\n    const plusIcon = (\r\n      <List.Icon\r\n        name=\"user plus\"\r\n        onClick={() => {\r\n          EventEmitter.publish('openInviteModal', true)\r\n        }}\r\n      />\r\n    )\r\n    const noPlusIcon = <div></div>\r\n\r\n    return this.state.currentGroup.id == group.id &&\r\n      this.state.vonageCred !== null\r\n      ? plusIcon\r\n      : noPlusIcon\r\n  }\r\n\r\n  getListItemStyle(group) {\r\n    const unClickedGroupsStyle = {\r\n      fontSize: '.8vw',\r\n      textAlign: 'left',\r\n      width: '80%',\r\n      marginBottom: '2%',\r\n      minWidth: '41px',\r\n      display: 'inline-block',\r\n    }\r\n\r\n    const clickedGroupsStyle = {\r\n      fontSize: '.8vw',\r\n      textAlign: 'left',\r\n      width: '80%',\r\n      marginBottom: '2%',\r\n      minWidth: '41px',\r\n      background: '#e0e1e2',\r\n      borderRadius: 10,\r\n      borderWidth: 1,\r\n      borderColor: '#fff',\r\n      display: 'inline-block',\r\n    }\r\n\r\n    return this.state.currentGroup.id == group.id &&\r\n      this.state.vonageCred !== null\r\n      ? clickedGroupsStyle\r\n      : unClickedGroupsStyle\r\n  }\r\n\r\n  showOffice() {\r\n    return (\r\n      <div style={{ paddingLeft: 20 }}>\r\n        <List relaxed selection verticalAlign=\"middle\">\r\n          {this.state.allGroups\r\n            .filter((group) => group.type === 'office')\r\n            .map((group) => (\r\n              <List.Item\r\n                key={`${group.name}`}\r\n                onClick={() => {\r\n                  if (this.state.currentClass.role === 'Student') {\r\n                    EventEmitter.publish('openOfficeAccessModal', true)\r\n                  } else if (this.state.currentGroup.id !== group.id) {\r\n                    this.handleSelectGroup(group)\r\n                  }\r\n                }}\r\n                style={this.getListItemStyle(group)}\r\n              >\r\n                <List.Icon name=\"graduation cap\" />\r\n                <List.Content>\r\n                  <List.Header as=\"a\">\r\n                    {group.name + ' (' + group.users.length + ')'}\r\n                  </List.Header>\r\n                </List.Content>\r\n                {this.showInviteButton(group)}\r\n              </List.Item>\r\n            ))}\r\n        </List>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  leftDisplay() {\r\n    return this.state.withTa === false ? (\r\n      <div style={{ height: '100%', marginLeft: '2.5%' }}>\r\n        <Button.Group\r\n          size=\"huge\"\r\n          style={{ marginBottom: 12, width: '100%' }}\r\n          fluid\r\n        >\r\n          <Button\r\n            compact\r\n            icon=\"angle left\"\r\n            content={this.state.currentClass.name}\r\n            style={{\r\n              fontSize: '1.5vw',\r\n              textAlign: 'left',\r\n              width: '75%',\r\n              marginBottom: '2%',\r\n              minWidth: '41px',\r\n            }}\r\n            onClick={this.handleBack}\r\n          />\r\n        </Button.Group>\r\n        {this.showOffice()}\r\n        <Accordion\r\n          fluid\r\n          exclusive={false}\r\n          defaultActiveIndex={[0, 1]}\r\n          style={{\r\n            fontSize: '1vw',\r\n            textAlign: 'left',\r\n            width: '100%',\r\n            marginBottom: '2%',\r\n            minWidth: '41px',\r\n          }}\r\n          panels={[\r\n            {\r\n              key: 'discussions',\r\n              title: 'Discussions',\r\n              content: {\r\n                content: (\r\n                  <div\r\n                    style={{ paddingLeft: 20, height: 200, overflow: 'auto' }}\r\n                  >\r\n                    <List relaxed selection>\r\n                      {this.state.allGroups\r\n                        .filter((group) => group.type === 'discussion')\r\n                        .map((group) => (\r\n                          <>\r\n                            <List.Item\r\n                              key={`discussion_${group.id}`}\r\n                              onClick={() => {\r\n                                if (this.state.currentGroup.id !== group.id) {\r\n                                  this.handleSelectGroup(group)\r\n                                }\r\n                              }}\r\n                              style={this.getListItemStyle(group)}\r\n                            >\r\n                              <List.Icon name=\"sound\" />\r\n                              <List.Content>\r\n                                <List.Header as=\"a\">\r\n                                  {group.name + ' (' + group.users.length + ')'}\r\n                                </List.Header>\r\n                              </List.Content>\r\n                              {this.showInviteButton(group)}\r\n                            </List.Item>\r\n                            {this.getDeleteButton(group)}\r\n                          </>\r\n                        ))}\r\n                    </List>\r\n                  </div>\r\n                ),\r\n              },\r\n            },\r\n            {\r\n              key: 'private-groups',\r\n              title: 'Private Groups',\r\n              content: {\r\n                content: (\r\n                  <div\r\n                    style={{ paddingLeft: 20, height: 200, overflow: 'auto' }}\r\n                  >\r\n                    <List relaxed selection>\r\n                      {this.state.allGroups\r\n                        .filter((group) => group.type === 'group')\r\n                        .map((group) => (\r\n                          <List.Item\r\n                            key={`private_group_${group.id}`}\r\n                            onClick={() => {\r\n                              if (this.state.currentGroup.id !== group.id) {\r\n                                this.handleSelectGroup(group)\r\n                              }\r\n                            }}\r\n                            style={this.getListItemStyle(group)}\r\n                          >\r\n                            <List.Icon name=\"lock\" />\r\n                            <List.Content>\r\n                              <List.Header as=\"a\">\r\n                                {group.name + ' (' + group.users.length + ')'}\r\n                              </List.Header>\r\n                            </List.Content>\r\n                            {this.showInviteButton(group)}\r\n                          </List.Item>\r\n                        ))}\r\n                    </List>\r\n                  </div>\r\n                ),\r\n              },\r\n            },\r\n          ]}\r\n        />\r\n        <div\r\n          style={{\r\n            position: 'absolute',\r\n            width: 'calc(100% - 38px)',\r\n            bottom: 14,\r\n          }}\r\n        >\r\n          {this.getButtonToDisplay()}\r\n        </div>\r\n      </div>\r\n    ) : (\r\n      <div style={{ height: '100%', marginLeft: '2.5%' }}>\r\n        <Button.Group\r\n          size=\"huge\"\r\n          style={{ marginBottom: 12, width: '100%' }}\r\n          fluid\r\n        >\r\n          <Button\r\n            compact\r\n            content={this.state.currentClass.name}\r\n            style={{\r\n              fontSize: '1.5vw',\r\n              textAlign: 'left',\r\n              width: '75%',\r\n              marginBottom: '2%',\r\n              minWidth: '41px',\r\n            }}\r\n          />\r\n        </Button.Group>\r\n        <Label\r\n          size=\"massive\"\r\n          style={{\r\n            fontSize: '1vw',\r\n            textAlign: 'center',\r\n            width: '100%',\r\n            marginBottom: '4%',\r\n            minWidth: '41px',\r\n          }}\r\n        >\r\n          You are currently in a TA's office. Please click the leave call button\r\n          to join another group.\r\n        </Label>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    if (!this.state.isMounted) {\r\n      return null\r\n    }\r\n\r\n    if (this.state.toRejoin) {\r\n      const group = JSON.parse(localStorage.getItem('lastCallEntered'))\r\n\r\n      confirmAlert({\r\n        title: 'Rejoin Call',\r\n        message:\r\n          'It appears you did not leave your last call. Would you like to rejoin it?',\r\n        buttons: [\r\n          {\r\n            label: 'Yes',\r\n            onClick: () => {\r\n              this.joinGroup(group)\r\n              this.setState(\r\n                {\r\n                  toRejoin: false,\r\n                },\r\n                () => {\r\n                  EventEmitter.publish('TARejoinCall')\r\n                }\r\n              )\r\n            },\r\n          },\r\n          {\r\n            label: 'No',\r\n            onClick: () => {\r\n              localStorage.removeItem('lastCallEntered')\r\n              this.setState({\r\n                toRejoin: false,\r\n              })\r\n            },\r\n          },\r\n        ],\r\n      })\r\n    }\r\n\r\n    return (\r\n      <Layout\r\n        left={this.leftDisplay()}\r\n        right={<Queue onJoin={this.handleSelectGroup} />}\r\n      >\r\n        {this.state.vonageCred && (\r\n          <ScreenContainer\r\n            style={{ width: '100%', maxHeight: '75vh' }}\r\n            sessionId={this.state.vonageCred.sessionId}\r\n            token={this.state.vonageCred.token}\r\n            onLeave={this.leaveGroup}\r\n            name={this.user.firstName + ' ' + this.user.lastName}\r\n          />\r\n        )}\r\n        <OfficeAccessModal />\r\n        <AccessDeniedModal />\r\n        <UserInviteModal />\r\n        <FeedbackModal />\r\n        <ReceiveInviteModal onJoin={this.handleSelectGroup} />\r\n        <GroupJoinRequestModal />\r\n        <WaitingForRequestApprovalModal />\r\n        <NotificationContainer />\r\n        <WaitingForNewLeaderModal user={this.user.id} />\r\n      </Layout>\r\n    )\r\n  }\r\n}\r\nexport default AuthRequired(withRouter(ClassPage))\r\n"]},"metadata":{},"sourceType":"module"}