{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconst url = 'ws://localhost:8080';\nimport { EventEmitter } from '../components/util/EventEmitter';\nconst role = 'Student';\n/**\n * QueueWebSocket controls the web socket business logic for the course queue and\n * functions as a controller for the queue state\n */\n\nexport default class StudentWebSocketClient {\n  start({\n    me,\n    courseId\n  }) {\n    const {\n      id\n    } = me;\n    this.id = id;\n    this.courseId = courseId;\n    this.connection = new WebSocket(url);\n    this.connection.onopen = this.processConnectionOpen.bind(this);\n    this.connection.onerror = this.processConnectionError.bind(this);\n    this.connection.onmessage = this.processConnectionMessage.bind(this);\n    this.defineEventEmitterCallbacks();\n  }\n\n  defineEventEmitterCallbacks() {\n    EventEmitter.subscribe('greeting', () => {\n      this.connection.send(this.prepareMessage({\n        msgType: 'greeting',\n        msg: this.id\n      }));\n    });\n    EventEmitter.subscribe('signalStudentTimeout', TAName => this.signalStudentTimeout(TAName));\n    EventEmitter.subscribe('signalJoinTA', ({\n      group,\n      TAName,\n      me\n    }) => {\n      this.signalJoinTA(group, TAName, me);\n    });\n    EventEmitter.subscribe('signalDeclineTA', TAName => {\n      this.signalDeclineTA(TAName);\n    });\n    EventEmitter.subscribe('signalCallOver', () => {\n      this.signalCallOver();\n    });\n    EventEmitter.subscribe('signalAddMeToQueue', () => {\n      this.addMeToQueue();\n    });\n    EventEmitter.subscribe('signalRemoveMeFromQueue', () => {\n      this.removeMeFromQueue();\n    });\n    EventEmitter.subscribe('sendOutInvite', ({\n      sender,\n      recepientIds,\n      group\n    }) => {\n      recepientIds.forEach(id => {\n        this.sendOutInvite(sender, id, group);\n      });\n    });\n    EventEmitter.subscribe('requestJoinGroup', data => {\n      this.connection.send(this.prepareMessage({\n        msgType: 'requestJoinGroup',\n        msg: JSON.stringify(data)\n      }));\n    });\n    EventEmitter.subscribe('acceptGroupJoinRequest', msg => {\n      this.connection.send(this.prepareMessage({\n        msgType: 'acceptGroupJoinRequest',\n        msg\n      }));\n    });\n    EventEmitter.subscribe('declineGroupJoinRequest', msg => {\n      this.connection.send(this.prepareMessage({\n        msgType: 'declineGroupJoinRequest',\n        msg\n      }));\n    });\n    EventEmitter.subscribe('classGroupSetChanged', classId => {\n      this.connection.send(this.prepareMessage({\n        msgType: 'classGroupSetChanged',\n        msg: classId\n      }));\n    });\n    EventEmitter.subscribe('userLeaveGroup', group => {\n      this.connection.send(this.prepareMessage({\n        msgType: 'userLeaveGroup',\n        msg: group\n      }));\n    });\n    EventEmitter.subscribe('userJoinGroup', data => {\n      this.connection.send(this.prepareMessage({\n        msgType: 'userJoinGroup',\n        msg: data\n      }));\n    });\n    EventEmitter.subscribe('startLeaderAppointmentProcess', data => {\n      this.connection.send(this.prepareMessage({\n        msgType: 'startLeaderAppointmentProcess',\n        msg: data\n      }));\n    });\n    EventEmitter.subscribe('sendLeaderAppointmentNotification', data => {\n      this.connection.send(this.prepareMessage({\n        msgType: 'leaderAppointmentNotification',\n        msg: data\n      }));\n    });\n    EventEmitter.subscribe('screenShareOn', data => {\n      this.connection.send(this.prepareMessage({\n        msgType: 'personWhoIsSharing',\n        msg: data\n      }));\n    });\n  }\n\n  processConnectionOpen() {\n    this.connection.send(this.prepareMessage({\n      msgType: 'greeting',\n      msg: this.id\n    })); // notify the server which courseId this websocket belongs to\n  }\n\n  processConnectionError(error) {\n    console.log(`WebSocket error: ${error}`);\n  }\n\n  activateYourTurnModal(TAName) {\n    EventEmitter.publish('activateYourTurnModal', TAName);\n  }\n\n  updateStudentsInQueue(msg) {\n    EventEmitter.publish('updateStudentsInQueue', msg);\n  }\n\n  updateCurrStudent(msg) {\n    EventEmitter.publish('updateCurrStudent', msg);\n  }\n\n  initializeQueueOnGreeting(msg) {\n    EventEmitter.publish('initializeQueueOnGreeting', msg);\n  }\n\n  activateReceiveInviteModal(msg) {\n    EventEmitter.publish('activateReceiveInviteModal', msg);\n  }\n\n  activateGroupJoinRequestModal(msg) {\n    EventEmitter.publish('activateGroupJoinRequestModal', msg);\n  }\n\n  joinPrivateGroupOnApproval(msg) {\n    EventEmitter.publish('joinPrivateGroupOnApproval', msg);\n  }\n\n  notifyJoinRequestDeclined(msg) {\n    EventEmitter.publish('notifyJoinRequestDeclined', msg);\n  }\n\n  notifyFetchGroups() {\n    EventEmitter.publish('fetchGroups');\n  }\n\n  refreshScreenContainer() {\n    EventEmitter.publish('refreshScreenContainer');\n  }\n\n  changeScreensharer(msg) {\n    EventEmitter.publish('newScreensharer', msg);\n  }\n\n  processConnectionMessage(e) {\n    const {\n      msgType,\n      msg\n    } = JSON.parse(e.data);\n\n    switch (msgType) {\n      case 'greetingAck':\n        this.initializeQueueOnGreeting(msg);\n        break;\n\n      case 'queue':\n        // in this case, the server will send a message indicating the current students in the queue\n        // msg - the new queue\n        this.updateStudentsInQueue(msg);\n        break;\n\n      case 'yourTurn':\n        // in this case, which is only if you are a student, the server notifies that it is your turn\n        // msg - the TA that notifies you\n        this.activateYourTurnModal(msg);\n        break;\n\n      case 'currStudentUpdate':\n        this.updateCurrStudent(msg);\n        break;\n\n      case 'receiveInvite':\n        // in this case, another student invites you to their group\n        // msg - sender, group\n        this.activateReceiveInviteModal(msg);\n        break;\n\n      case 'groupJoinRequest':\n        this.activateGroupJoinRequestModal(msg); // msg - the name of the student wanting to join\n\n        break;\n\n      case 'groupJoinRequestApproved':\n        this.joinPrivateGroupOnApproval(msg);\n        break;\n\n      case 'groupJoinRequestDeclined':\n        this.notifyJoinRequestDeclined(msg);\n        break;\n\n      case 'fetchGroups':\n        this.notifyFetchGroups();\n        break;\n\n      case 'newLeaderAppointed':\n        this.refreshScreenContainer();\n        break;\n\n      case 'fetchScreensharer':\n        this.changeScreensharer(msg);\n        break;\n\n      default:\n        throw new Error(`Message ${msgType} is incorrectly formatted`);\n    }\n  }\n\n  addMeToQueue() {\n    this.connection.send(this.prepareMessage({\n      msgType: 'addToQueue',\n      msg: this.id\n    }));\n    EventEmitter.publish('addMeToQueue');\n  }\n\n  removeMeFromQueue() {\n    this.connection.send(this.prepareMessage({\n      msgType: 'removeFromQueue',\n      msg: this.id\n    }));\n    EventEmitter.publish('removeMeFromQueue');\n  }\n\n  signalStudentTimeout(TAName) {\n    this.connection.send(this.prepareMessage({\n      msgType: 'studentTimeout',\n      msg: TAName\n    }));\n  }\n\n  signalJoinTA(group, TAName, me) {\n    this.connection.send(this.prepareMessage({\n      msgType: 'joinTA',\n      msg: JSON.stringify({\n        group,\n        TAName,\n        me\n      })\n    }));\n    EventEmitter.publish('clearLeftSide');\n  }\n\n  signalDeclineTA(TAName) {\n    this.connection.send(this.prepareMessage({\n      msgType: 'declineTA',\n      msg: TAName\n    }));\n  }\n\n  signalCallOver() {\n    this.connection.send(this.prepareMessage({\n      msgType: 'callOver',\n      msg: 'callOver'\n    }));\n  }\n\n  sendOutInvite(sender, recepientId, group) {\n    this.connection.send(this.prepareMessage({\n      msgType: 'sendOutInvite',\n      msg: JSON.stringify({\n        sender,\n        recepientId,\n        group\n      })\n    }));\n  }\n\n  prepareMessage(msg) {\n    const {\n      courseId\n    } = this;\n\n    const enrichedPayload = _objectSpread(_objectSpread({}, msg), {}, {\n      courseId,\n      role\n    });\n\n    return JSON.stringify(enrichedPayload);\n  }\n\n}","map":{"version":3,"sources":["C:/Users/ryanj/Documents/mercury/util/studentWebSocket.js"],"names":["url","EventEmitter","role","StudentWebSocketClient","start","me","courseId","id","connection","WebSocket","onopen","processConnectionOpen","bind","onerror","processConnectionError","onmessage","processConnectionMessage","defineEventEmitterCallbacks","subscribe","send","prepareMessage","msgType","msg","TAName","signalStudentTimeout","group","signalJoinTA","signalDeclineTA","signalCallOver","addMeToQueue","removeMeFromQueue","sender","recepientIds","forEach","sendOutInvite","data","JSON","stringify","classId","error","console","log","activateYourTurnModal","publish","updateStudentsInQueue","updateCurrStudent","initializeQueueOnGreeting","activateReceiveInviteModal","activateGroupJoinRequestModal","joinPrivateGroupOnApproval","notifyJoinRequestDeclined","notifyFetchGroups","refreshScreenContainer","changeScreensharer","e","parse","Error","recepientId","enrichedPayload"],"mappings":"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","sourcesContent":["const url = 'ws://localhost:8080'\nimport { EventEmitter } from '../components/util/EventEmitter'\nconst role = 'Student'\n/**\n * QueueWebSocket controls the web socket business logic for the course queue and\n * functions as a controller for the queue state\n */\n\nexport default class StudentWebSocketClient {\n  start({ me, courseId }) {\n    const { id } = me\n    this.id = id\n    this.courseId = courseId\n\n    this.connection = new WebSocket(url)\n    this.connection.onopen = this.processConnectionOpen.bind(this)\n    this.connection.onerror = this.processConnectionError.bind(this)\n    this.connection.onmessage = this.processConnectionMessage.bind(this)\n\n    this.defineEventEmitterCallbacks()\n  }\n\n  defineEventEmitterCallbacks() {\n    EventEmitter.subscribe('greeting', () => {\n      this.connection.send(\n        this.prepareMessage({\n          msgType: 'greeting',\n          msg: this.id,\n        })\n      )\n    })\n\n    EventEmitter.subscribe('signalStudentTimeout', (TAName) =>\n      this.signalStudentTimeout(TAName)\n    )\n\n    EventEmitter.subscribe('signalJoinTA', ({ group, TAName, me }) => {\n      this.signalJoinTA(group, TAName, me)\n    })\n\n    EventEmitter.subscribe('signalDeclineTA', (TAName) => {\n      this.signalDeclineTA(TAName)\n    })\n\n    EventEmitter.subscribe('signalCallOver', () => {\n      this.signalCallOver()\n    })\n\n    EventEmitter.subscribe('signalAddMeToQueue', () => {\n      this.addMeToQueue()\n    })\n\n    EventEmitter.subscribe('signalRemoveMeFromQueue', () => {\n      this.removeMeFromQueue()\n    })\n\n    EventEmitter.subscribe(\n      'sendOutInvite',\n      ({ sender, recepientIds, group }) => {\n        recepientIds.forEach((id) => {\n          this.sendOutInvite(sender, id, group)\n        })\n      }\n    )\n\n    EventEmitter.subscribe('requestJoinGroup', (data) => {\n      this.connection.send(\n        this.prepareMessage({\n          msgType: 'requestJoinGroup',\n          msg: JSON.stringify(data),\n        })\n      )\n    })\n\n    EventEmitter.subscribe('acceptGroupJoinRequest', (msg) => {\n      this.connection.send(\n        this.prepareMessage({\n          msgType: 'acceptGroupJoinRequest',\n          msg,\n        })\n      )\n    })\n\n    EventEmitter.subscribe('declineGroupJoinRequest', (msg) => {\n      this.connection.send(\n        this.prepareMessage({\n          msgType: 'declineGroupJoinRequest',\n          msg,\n        })\n      )\n    })\n\n    EventEmitter.subscribe('classGroupSetChanged', (classId) => {\n      this.connection.send(\n        this.prepareMessage({\n          msgType: 'classGroupSetChanged',\n          msg: classId,\n        })\n      )\n    })\n\n    EventEmitter.subscribe('userLeaveGroup', (group) => {\n      this.connection.send(\n        this.prepareMessage({\n          msgType: 'userLeaveGroup',\n          msg: group,\n        })\n      )\n    })\n\n    EventEmitter.subscribe('userJoinGroup', (data) => {\n      this.connection.send(\n        this.prepareMessage({\n          msgType: 'userJoinGroup',\n          msg: data,\n        })\n      )\n    })\n\n    EventEmitter.subscribe('startLeaderAppointmentProcess', (data) => {\n      this.connection.send(\n        this.prepareMessage({\n          msgType: 'startLeaderAppointmentProcess',\n          msg: data,\n        })\n      )\n    })\n\n    EventEmitter.subscribe('sendLeaderAppointmentNotification', (data) => {\n      this.connection.send(\n        this.prepareMessage({\n          msgType: 'leaderAppointmentNotification',\n          msg: data,\n        })\n      )\n    })\n\n    EventEmitter.subscribe('screenShareOn', (data) => {\n      this.connection.send(\n        this.prepareMessage({\n          msgType: 'personWhoIsSharing',\n          msg: data,\n        })\n      )\n    })\n  }\n\n  processConnectionOpen() {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'greeting',\n        msg: this.id,\n      })\n    ) // notify the server which courseId this websocket belongs to\n  }\n\n  processConnectionError(error) {\n    console.log(`WebSocket error: ${error}`)\n  }\n\n  activateYourTurnModal(TAName) {\n    EventEmitter.publish('activateYourTurnModal', TAName)\n  }\n\n  updateStudentsInQueue(msg) {\n    EventEmitter.publish('updateStudentsInQueue', msg)\n  }\n\n  updateCurrStudent(msg) {\n    EventEmitter.publish('updateCurrStudent', msg)\n  }\n\n  initializeQueueOnGreeting(msg) {\n    EventEmitter.publish('initializeQueueOnGreeting', msg)\n  }\n\n  activateReceiveInviteModal(msg) {\n    EventEmitter.publish('activateReceiveInviteModal', msg)\n  }\n\n  activateGroupJoinRequestModal(msg) {\n    EventEmitter.publish('activateGroupJoinRequestModal', msg)\n  }\n\n  joinPrivateGroupOnApproval(msg) {\n    EventEmitter.publish('joinPrivateGroupOnApproval', msg)\n  }\n\n  notifyJoinRequestDeclined(msg) {\n    EventEmitter.publish('notifyJoinRequestDeclined', msg)\n  }\n\n  notifyFetchGroups() {\n    EventEmitter.publish('fetchGroups')\n  }\n\n  refreshScreenContainer() {\n    EventEmitter.publish('refreshScreenContainer')\n  }\n\n  changeScreensharer(msg) {\n    EventEmitter.publish('newScreensharer', msg)\n  }\n\n  processConnectionMessage(e) {\n    const { msgType, msg } = JSON.parse(e.data)\n\n    switch (msgType) {\n      case 'greetingAck':\n        this.initializeQueueOnGreeting(msg)\n        break\n\n      case 'queue': // in this case, the server will send a message indicating the current students in the queue\n        // msg - the new queue\n        this.updateStudentsInQueue(msg)\n        break\n\n      case 'yourTurn': // in this case, which is only if you are a student, the server notifies that it is your turn\n        // msg - the TA that notifies you\n        this.activateYourTurnModal(msg)\n        break\n\n      case 'currStudentUpdate':\n        this.updateCurrStudent(msg)\n        break\n\n      case 'receiveInvite': // in this case, another student invites you to their group\n        // msg - sender, group\n        this.activateReceiveInviteModal(msg)\n        break\n\n      case 'groupJoinRequest':\n        this.activateGroupJoinRequestModal(msg) // msg - the name of the student wanting to join\n        break\n\n      case 'groupJoinRequestApproved':\n        this.joinPrivateGroupOnApproval(msg)\n        break\n\n      case 'groupJoinRequestDeclined':\n        this.notifyJoinRequestDeclined(msg)\n        break\n\n      case 'fetchGroups':\n        this.notifyFetchGroups()\n        break\n\n      case 'newLeaderAppointed':\n        this.refreshScreenContainer()\n        break\n\n      case 'fetchScreensharer':\n        this.changeScreensharer(msg)\n        break\n\n      default:\n        throw new Error(`Message ${msgType} is incorrectly formatted`)\n    }\n  }\n\n  addMeToQueue() {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'addToQueue',\n        msg: this.id,\n      })\n    )\n\n    EventEmitter.publish('addMeToQueue')\n  }\n\n  removeMeFromQueue() {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'removeFromQueue',\n        msg: this.id,\n      })\n    )\n\n    EventEmitter.publish('removeMeFromQueue')\n  }\n\n  signalStudentTimeout(TAName) {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'studentTimeout',\n        msg: TAName,\n      })\n    )\n  }\n\n  signalJoinTA(group, TAName, me) {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'joinTA',\n        msg: JSON.stringify({ group, TAName, me }),\n      })\n    )\n\n    EventEmitter.publish('clearLeftSide')\n  }\n\n  signalDeclineTA(TAName) {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'declineTA',\n        msg: TAName,\n      })\n    )\n  }\n\n  signalCallOver() {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'callOver',\n        msg: 'callOver',\n      })\n    )\n  }\n\n  sendOutInvite(sender, recepientId, group) {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'sendOutInvite',\n        msg: JSON.stringify({ sender, recepientId, group }),\n      })\n    )\n  }\n\n  prepareMessage(msg) {\n    const { courseId } = this\n    const enrichedPayload = { ...msg, courseId, role }\n    return JSON.stringify(enrichedPayload)\n  }\n}\n"]},"metadata":{},"sourceType":"module"}