{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nconst url = 'ws://localhost:8080';\nconst role = 'Student';\nimport { EventEmitter } from '../../util/EventEmitter';\n/**\n * QueueWebSocket controls the web socket business logic for the course queue and\n * functions as a controller for the queue state\n */\n\nexport default class StudentWebSocketController {\n  start({\n    me,\n    courseId\n  }) {\n    const {\n      firstName,\n      lastName\n    } = me;\n    this.fullName = `${firstName} ${lastName}`;\n    this.courseId = courseId;\n    this.connection = new WebSocket(url);\n    this.connection.onopen = this.processConnectionOpen.bind(this);\n    this.connection.onerror = this.processConnectionError.bind(this);\n    this.connection.onmessage = this.processConnectionMessage.bind(this);\n  }\n\n  processConnectionOpen() {\n    const {\n      fullName\n    } = this;\n    this.connection.send(this.prepareMessage({\n      msgType: 'greeting',\n      msg: fullName\n    })); // notify the server which courseId this websocket belongs to\n  }\n\n  processConnectionError(error) {\n    console.log(`WebSocket error: ${error}`);\n  }\n\n  activateYourTurnModal(TAName) {\n    EventEmitter.publish('activateYourTurnModal', TAName);\n  }\n\n  updateStudentsInQueue(msg) {\n    EventEmitter.publish('updateStudentsInQueue', msg);\n  }\n\n  updateCurrStudent(msg) {\n    EventEmitter.publish('updateCurrStudent', msg);\n  }\n\n  initializeQueueOnGreeting(msg) {\n    EventEmitter.publish('initializeQueueOnGreeting', msg);\n  }\n\n  processConnectionMessage(e) {\n    const {\n      msgType,\n      msg\n    } = JSON.parse(e.data);\n\n    switch (msgType) {\n      case 'greetingAck':\n        this.initializeQueueOnGreeting(msg);\n        break;\n\n      case 'queue':\n        // in this case, the server will send a message indicating the current students in the queue\n        // msg - the new queue\n        this.updateStudentsInQueue(msg);\n        break;\n\n      case 'yourTurn':\n        // in this case, which os only if you arw a student, the server notifies that it is your turn\n        // msg - the TA that notifies you\n        this.activateYourTurnModal(msg);\n        break;\n\n      case 'currStudentUpdate':\n        this.updateCurrStudent(msg);\n        break;\n\n      default:\n        throw new Error(`Message ${msgType} is incorrectly formatted`);\n    }\n  }\n\n  addMeToQueue() {\n    this.connection.send(this.prepareMessage({\n      msgType: 'addToQueue',\n      msg: this.fullName\n    }));\n    EventEmitter.publish('addMeToQueue');\n  }\n\n  removeMeFromQueue() {\n    this.connection.send(this.prepareMessage({\n      msgType: 'removeFromQueue',\n      msg: this.fullName\n    }));\n    EventEmitter.publish('removeMeFromQueue');\n  }\n\n  signalStudentTimeout(TAName) {\n    this.connection.send(this.prepareMessage({\n      msgType: 'studentTimeout',\n      msg: TAName\n    }));\n  }\n\n  signalJoinTA(group, TAName, me) {\n    this.connection.send(this.prepareMessage({\n      msgType: 'joinTA',\n      msg: JSON.stringify({\n        group,\n        TAName,\n        me\n      })\n    }));\n    EventEmitter.publish('clearLeftSide');\n  }\n\n  signalDeclineTA(TAName) {\n    this.connection.send(this.prepareMessage({\n      msgType: 'declineTA',\n      msg: TAName\n    }));\n  }\n\n  prepareMessage(msg) {\n    const {\n      courseId\n    } = this;\n\n    const enrichedPayload = _objectSpread(_objectSpread({}, msg), {}, {\n      courseId,\n      role\n    });\n\n    return JSON.stringify(enrichedPayload);\n  }\n\n}","map":{"version":3,"sources":["C:/Users/ryanj/Documents/mercury/components/queue/student/studentWebSocket.js"],"names":["url","role","EventEmitter","StudentWebSocketController","start","me","courseId","firstName","lastName","fullName","connection","WebSocket","onopen","processConnectionOpen","bind","onerror","processConnectionError","onmessage","processConnectionMessage","send","prepareMessage","msgType","msg","error","console","log","activateYourTurnModal","TAName","publish","updateStudentsInQueue","updateCurrStudent","initializeQueueOnGreeting","e","JSON","parse","data","Error","addMeToQueue","removeMeFromQueue","signalStudentTimeout","signalJoinTA","group","stringify","signalDeclineTA","enrichedPayload"],"mappings":"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","sourcesContent":["const url = 'ws://localhost:8080'\nconst role = 'Student'\nimport { EventEmitter } from '../../util/EventEmitter'\n\n/**\n * QueueWebSocket controls the web socket business logic for the course queue and\n * functions as a controller for the queue state\n */\n\nexport default class StudentWebSocketController {\n  start({ me, courseId }) {\n    const { firstName, lastName } = me\n    this.fullName = `${firstName} ${lastName}`\n    this.courseId = courseId\n\n    this.connection = new WebSocket(url)\n    this.connection.onopen = this.processConnectionOpen.bind(this)\n    this.connection.onerror = this.processConnectionError.bind(this)\n    this.connection.onmessage = this.processConnectionMessage.bind(this)\n  }\n\n  processConnectionOpen() {\n    const { fullName } = this\n\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'greeting',\n        msg: fullName,\n      })\n    ) // notify the server which courseId this websocket belongs to\n  }\n\n  processConnectionError(error) {\n    console.log(`WebSocket error: ${error}`)\n  }\n\n  activateYourTurnModal(TAName) {\n    EventEmitter.publish('activateYourTurnModal', TAName)\n  }\n\n  updateStudentsInQueue(msg) {\n    EventEmitter.publish('updateStudentsInQueue', msg)\n  }\n\n  updateCurrStudent(msg) {\n    EventEmitter.publish('updateCurrStudent', msg)\n  }\n\n  initializeQueueOnGreeting(msg) {\n    EventEmitter.publish('initializeQueueOnGreeting', msg)\n  }\n\n  processConnectionMessage(e) {\n    const { msgType, msg } = JSON.parse(e.data)\n\n    switch (msgType) {\n      case 'greetingAck':\n        this.initializeQueueOnGreeting(msg)\n        break\n\n      case 'queue': // in this case, the server will send a message indicating the current students in the queue\n        // msg - the new queue\n        this.updateStudentsInQueue(msg)\n        break\n\n      case 'yourTurn': // in this case, which os only if you arw a student, the server notifies that it is your turn\n        // msg - the TA that notifies you\n        this.activateYourTurnModal(msg)\n        break\n\n      case 'currStudentUpdate':\n        this.updateCurrStudent(msg)\n        break\n\n      default:\n        throw new Error(`Message ${msgType} is incorrectly formatted`)\n    }\n  }\n\n  addMeToQueue() {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'addToQueue',\n        msg: this.fullName,\n      })\n    )\n\n    EventEmitter.publish('addMeToQueue')\n  }\n\n  removeMeFromQueue() {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'removeFromQueue',\n        msg: this.fullName,\n      })\n    )\n\n    EventEmitter.publish('removeMeFromQueue')\n  }\n\n  signalStudentTimeout(TAName) {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'studentTimeout',\n        msg: TAName,\n      })\n    )\n  }\n\n  signalJoinTA(group, TAName, me) {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'joinTA',\n        msg: JSON.stringify({ group, TAName, me }),\n      })\n    )\n\n    EventEmitter.publish('clearLeftSide')\n  }\n\n  signalDeclineTA(TAName) {\n    this.connection.send(\n      this.prepareMessage({\n        msgType: 'declineTA',\n        msg: TAName,\n      })\n    )\n  }\n\n  prepareMessage(msg) {\n    const { courseId } = this\n    const enrichedPayload = { ...msg, courseId, role }\n    return JSON.stringify(enrichedPayload)\n  }\n}\n"]},"metadata":{},"sourceType":"module"}