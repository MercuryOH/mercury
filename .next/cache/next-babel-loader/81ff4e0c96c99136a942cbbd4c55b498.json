{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar url = 'ws://localhost:8080';\nimport { EventEmitter } from '../components/util/EventEmitter';\nvar role = 'Student';\n/**\r\n * QueueWebSocket controls the web socket business logic for the course queue and\r\n * functions as a controller for the queue state\r\n */\n\nvar StudentWebSocketClient = /*#__PURE__*/function () {\n  function StudentWebSocketClient() {\n    _classCallCheck(this, StudentWebSocketClient);\n  }\n\n  _createClass(StudentWebSocketClient, [{\n    key: \"start\",\n    value: function start(_ref) {\n      var me = _ref.me,\n          courseId = _ref.courseId;\n      var id = me.id;\n      this.id = id;\n      this.courseId = courseId;\n      this.connection = new WebSocket(url);\n      this.connection.onopen = this.processConnectionOpen.bind(this);\n      this.connection.onerror = this.processConnectionError.bind(this);\n      this.connection.onmessage = this.processConnectionMessage.bind(this);\n      this.defineEventEmitterCallbacks();\n    }\n  }, {\n    key: \"defineEventEmitterCallbacks\",\n    value: function defineEventEmitterCallbacks() {\n      var _this = this;\n\n      EventEmitter.subscribe('greeting', function () {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'greeting',\n          msg: _this.id\n        }));\n      });\n      EventEmitter.subscribe('signalStudentTimeout', function (TAName) {\n        return _this.signalStudentTimeout(TAName);\n      });\n      EventEmitter.subscribe('signalJoinTA', function (_ref2) {\n        var group = _ref2.group,\n            TAName = _ref2.TAName,\n            me = _ref2.me;\n\n        _this.signalJoinTA(group, TAName, me);\n      });\n      EventEmitter.subscribe('signalDeclineTA', function (TAName) {\n        _this.signalDeclineTA(TAName);\n      });\n      EventEmitter.subscribe('signalCallOver', function () {\n        _this.signalCallOver();\n      });\n      EventEmitter.subscribe('signalAddMeToQueue', function () {\n        _this.addMeToQueue();\n      });\n      EventEmitter.subscribe('signalRemoveMeFromQueue', function () {\n        _this.removeMeFromQueue();\n      });\n      EventEmitter.subscribe('sendOutInvite', function (_ref3) {\n        var sender = _ref3.sender,\n            recepientIds = _ref3.recepientIds,\n            group = _ref3.group;\n        recepientIds.forEach(function (id) {\n          _this.sendOutInvite(sender, id, group);\n        });\n      });\n      EventEmitter.subscribe('requestJoinGroup', function (data) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'requestJoinGroup',\n          msg: JSON.stringify(data)\n        }));\n      });\n      EventEmitter.subscribe('acceptGroupJoinRequest', function (msg) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'acceptGroupJoinRequest',\n          msg: msg\n        }));\n      });\n      EventEmitter.subscribe('declineGroupJoinRequest', function (msg) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'declineGroupJoinRequest',\n          msg: msg\n        }));\n      });\n      EventEmitter.subscribe('classGroupSetChanged', function (classId) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'classGroupSetChanged',\n          msg: classId\n        }));\n      });\n      EventEmitter.subscribe('userLeaveGroup', function (group) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'userLeaveGroup',\n          msg: group\n        }));\n      });\n      EventEmitter.subscribe('userJoinGroup', function (data) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'userJoinGroup',\n          msg: data\n        }));\n      });\n      EventEmitter.subscribe('startLeaderAppointmentProcess', function (data) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'startLeaderAppointmentProcess',\n          msg: data\n        }));\n      });\n      EventEmitter.subscribe('sendLeaderAppointmentNotification', function (data) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'leaderAppointmentNotification',\n          msg: data\n        }));\n      });\n      EventEmitter.subscribe('screenShareOn', function (data) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'screenShareOn',\n          msg: data\n        }));\n      });\n    }\n  }, {\n    key: \"processConnectionOpen\",\n    value: function processConnectionOpen() {\n      this.connection.send(this.prepareMessage({\n        msgType: 'greeting',\n        msg: this.id\n      })); // notify the server which courseId this websocket belongs to\n    }\n  }, {\n    key: \"processConnectionError\",\n    value: function processConnectionError(error) {\n      console.log(\"WebSocket error: \".concat(error));\n    }\n  }, {\n    key: \"activateYourTurnModal\",\n    value: function activateYourTurnModal(TAName) {\n      EventEmitter.publish('activateYourTurnModal', TAName);\n    }\n  }, {\n    key: \"updateStudentsInQueue\",\n    value: function updateStudentsInQueue(msg) {\n      EventEmitter.publish('updateStudentsInQueue', msg);\n    }\n  }, {\n    key: \"updateCurrStudent\",\n    value: function updateCurrStudent(msg) {\n      EventEmitter.publish('updateCurrStudent', msg);\n    }\n  }, {\n    key: \"initializeQueueOnGreeting\",\n    value: function initializeQueueOnGreeting(msg) {\n      EventEmitter.publish('initializeQueueOnGreeting', msg);\n    }\n  }, {\n    key: \"activateReceiveInviteModal\",\n    value: function activateReceiveInviteModal(msg) {\n      EventEmitter.publish('activateReceiveInviteModal', msg);\n    }\n  }, {\n    key: \"activateGroupJoinRequestModal\",\n    value: function activateGroupJoinRequestModal(msg) {\n      EventEmitter.publish('activateGroupJoinRequestModal', msg);\n    }\n  }, {\n    key: \"joinPrivateGroupOnApproval\",\n    value: function joinPrivateGroupOnApproval(msg) {\n      EventEmitter.publish('joinPrivateGroupOnApproval', msg);\n    }\n  }, {\n    key: \"notifyJoinRequestDeclined\",\n    value: function notifyJoinRequestDeclined(msg) {\n      EventEmitter.publish('notifyJoinRequestDeclined', msg);\n    }\n  }, {\n    key: \"notifyFetchGroups\",\n    value: function notifyFetchGroups() {\n      EventEmitter.publish('fetchGroups');\n    }\n  }, {\n    key: \"refreshScreenContainer\",\n    value: function refreshScreenContainer() {\n      EventEmitter.publish('refreshScreenContainer');\n    }\n  }, {\n    key: \"changeScreensharer\",\n    value: function changeScreensharer(msg) {\n      EventEmitter.publish('newScreensharer', msg);\n    }\n  }, {\n    key: \"processConnectionMessage\",\n    value: function processConnectionMessage(e) {\n      var _JSON$parse = JSON.parse(e.data),\n          msgType = _JSON$parse.msgType,\n          msg = _JSON$parse.msg;\n\n      switch (msgType) {\n        case 'greetingAck':\n          this.initializeQueueOnGreeting(msg);\n          break;\n\n        case 'queue':\n          // in this case, the server will send a message indicating the current students in the queue\n          // msg - the new queue\n          this.updateStudentsInQueue(msg);\n          break;\n\n        case 'yourTurn':\n          // in this case, which is only if you are a student, the server notifies that it is your turn\n          // msg - the TA that notifies you\n          this.activateYourTurnModal(msg);\n          break;\n\n        case 'currStudentUpdate':\n          this.updateCurrStudent(msg);\n          break;\n\n        case 'receiveInvite':\n          // in this case, another student invites you to their group\n          // msg - sender, group\n          this.activateReceiveInviteModal(msg);\n          break;\n\n        case 'groupJoinRequest':\n          this.activateGroupJoinRequestModal(msg); // msg - the name of the student wanting to join\n\n          break;\n\n        case 'groupJoinRequestApproved':\n          this.joinPrivateGroupOnApproval(msg);\n          break;\n\n        case 'groupJoinRequestDeclined':\n          this.notifyJoinRequestDeclined(msg);\n          break;\n\n        case 'fetchGroups':\n          this.notifyFetchGroups();\n          break;\n\n        case 'newLeaderAppointed':\n          this.refreshScreenContainer();\n          break;\n\n        case 'fetchScreensharer':\n          this.changeScreensharer(msg);\n          break;\n\n        default:\n          throw new Error(\"Message \".concat(msgType, \" is incorrectly formatted\"));\n      }\n    }\n  }, {\n    key: \"addMeToQueue\",\n    value: function addMeToQueue() {\n      this.connection.send(this.prepareMessage({\n        msgType: 'addToQueue',\n        msg: this.id\n      }));\n      EventEmitter.publish('addMeToQueue');\n    }\n  }, {\n    key: \"removeMeFromQueue\",\n    value: function removeMeFromQueue() {\n      this.connection.send(this.prepareMessage({\n        msgType: 'removeFromQueue',\n        msg: this.id\n      }));\n      EventEmitter.publish('removeMeFromQueue');\n    }\n  }, {\n    key: \"signalStudentTimeout\",\n    value: function signalStudentTimeout(TAName) {\n      this.connection.send(this.prepareMessage({\n        msgType: 'studentTimeout',\n        msg: TAName\n      }));\n    }\n  }, {\n    key: \"signalJoinTA\",\n    value: function signalJoinTA(group, TAName, me) {\n      this.connection.send(this.prepareMessage({\n        msgType: 'joinTA',\n        msg: JSON.stringify({\n          group: group,\n          TAName: TAName,\n          me: me\n        })\n      }));\n      EventEmitter.publish('clearLeftSide');\n    }\n  }, {\n    key: \"signalDeclineTA\",\n    value: function signalDeclineTA(TAName) {\n      this.connection.send(this.prepareMessage({\n        msgType: 'declineTA',\n        msg: TAName\n      }));\n    }\n  }, {\n    key: \"signalCallOver\",\n    value: function signalCallOver() {\n      this.connection.send(this.prepareMessage({\n        msgType: 'callOver',\n        msg: 'callOver'\n      }));\n    }\n  }, {\n    key: \"sendOutInvite\",\n    value: function sendOutInvite(sender, recepientId, group) {\n      this.connection.send(this.prepareMessage({\n        msgType: 'sendOutInvite',\n        msg: JSON.stringify({\n          sender: sender,\n          recepientId: recepientId,\n          group: group\n        })\n      }));\n    }\n  }, {\n    key: \"prepareMessage\",\n    value: function prepareMessage(msg) {\n      var courseId = this.courseId;\n\n      var enrichedPayload = _objectSpread(_objectSpread({}, msg), {}, {\n        courseId: courseId,\n        role: role\n      });\n\n      return JSON.stringify(enrichedPayload);\n    }\n  }]);\n\n  return StudentWebSocketClient;\n}();\n\nexport { StudentWebSocketClient as default };","map":null,"metadata":{},"sourceType":"module"}