{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar url = 'ws://localhost:8080';\nimport { EventEmitter } from '../components/util/EventEmitter';\nvar role = 'Student';\n/**\r\n * QueueWebSocket controls the web socket business logic for the course queue and\r\n * functions as a controller for the queue state\r\n */\n\nvar StudentWebSocketClient = /*#__PURE__*/function () {\n  function StudentWebSocketClient() {\n    _classCallCheck(this, StudentWebSocketClient);\n  }\n\n  _createClass(StudentWebSocketClient, [{\n    key: \"start\",\n    value: function start(_ref) {\n      var me = _ref.me,\n          courseId = _ref.courseId;\n      var id = me.id;\n      this.id = id;\n      this.courseId = courseId;\n      this.connection = new WebSocket(url);\n      this.connection.onopen = this.processConnectionOpen.bind(this);\n      this.connection.onerror = this.processConnectionError.bind(this);\n      this.connection.onmessage = this.processConnectionMessage.bind(this);\n      this.defineEventEmitterCallbacks();\n    }\n  }, {\n    key: \"defineEventEmitterCallbacks\",\n    value: function defineEventEmitterCallbacks() {\n      var _this = this;\n\n      EventEmitter.subscribe('greeting', function () {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'greeting',\n          msg: _this.id\n        }));\n      });\n      EventEmitter.subscribe('signalStudentTimeout', function (TAName) {\n        return _this.signalStudentTimeout(TAName);\n      });\n      EventEmitter.subscribe('signalJoinTA', function (_ref2) {\n        var group = _ref2.group,\n            TAName = _ref2.TAName,\n            me = _ref2.me;\n\n        _this.signalJoinTA(group, TAName, me);\n      });\n      EventEmitter.subscribe('signalDeclineTA', function (TAName) {\n        _this.signalDeclineTA(TAName);\n      });\n      EventEmitter.subscribe('signalCallOver', function () {\n        _this.signalCallOver();\n      });\n      EventEmitter.subscribe('signalAddMeToQueue', function () {\n        _this.addMeToQueue();\n      });\n      EventEmitter.subscribe('signalRemoveMeFromQueue', function () {\n        _this.removeMeFromQueue();\n      });\n      EventEmitter.subscribe('sendOutInvite', function (_ref3) {\n        var sender = _ref3.sender,\n            recepientIds = _ref3.recepientIds,\n            group = _ref3.group;\n        recepientIds.forEach(function (id) {\n          _this.sendOutInvite(sender, id, group);\n        });\n      });\n      EventEmitter.subscribe('requestJoinGroup', function (data) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'requestJoinGroup',\n          msg: JSON.stringify(data)\n        }));\n      });\n      EventEmitter.subscribe('acceptGroupJoinRequest', function (msg) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'acceptGroupJoinRequest',\n          msg: msg\n        }));\n      });\n      EventEmitter.subscribe('declineGroupJoinRequest', function (msg) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'declineGroupJoinRequest',\n          msg: msg\n        }));\n      });\n      EventEmitter.subscribe('classGroupSetChanged', function (classId) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'classGroupSetChanged',\n          msg: classId\n        }));\n      });\n      EventEmitter.subscribe('userLeaveGroup', function (group) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'userLeaveGroup',\n          msg: group\n        }));\n      });\n      EventEmitter.subscribe('userJoinGroup', function (data) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'userJoinGroup',\n          msg: data\n        }));\n      });\n      EventEmitter.subscribe('bidForLeaderPosition', function (_ref4) {\n        var userId = _ref4.userId,\n            groupId = _ref4.groupId;\n\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'bidForLeaderPosition',\n          msg: {\n            newLeader: _this.id,\n            oldLeader: userId,\n            groupId: groupId\n          }\n        }));\n      });\n      EventEmitter.subscribe('screenShareOn', function (data) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'screenShareOn',\n          msg: data\n        }));\n      });\n      EventEmitter.subscribe('declineWaitingForRequestApproval', function (group) {\n        _this.connection.send(_this.prepareMessage({\n          msgType: 'declineWaitingForRequestApproval',\n          msg: group\n        }));\n      });\n    }\n  }, {\n    key: \"processConnectionOpen\",\n    value: function processConnectionOpen() {\n      this.connection.send(this.prepareMessage({\n        msgType: 'greeting',\n        msg: this.id\n      })); // notify the server which courseId this websocket belongs to\n    }\n  }, {\n    key: \"processConnectionError\",\n    value: function processConnectionError(error) {\n      console.log(\"WebSocket error: \".concat(error));\n    }\n  }, {\n    key: \"activateYourTurnModal\",\n    value: function activateYourTurnModal(TAName) {\n      EventEmitter.publish('activateYourTurnModal', TAName);\n    }\n  }, {\n    key: \"updateStudentsInQueue\",\n    value: function updateStudentsInQueue(msg) {\n      EventEmitter.publish('updateStudentsInQueue', msg);\n    }\n  }, {\n    key: \"updateCurrStudent\",\n    value: function updateCurrStudent(msg) {\n      EventEmitter.publish('updateCurrStudent', msg);\n    }\n  }, {\n    key: \"initializeQueueOnGreeting\",\n    value: function initializeQueueOnGreeting(msg) {\n      EventEmitter.publish('initializeQueueOnGreeting', msg);\n    }\n  }, {\n    key: \"activateReceiveInviteModal\",\n    value: function activateReceiveInviteModal(msg) {\n      EventEmitter.publish('activateReceiveInviteModal', msg);\n    }\n  }, {\n    key: \"activateGroupJoinRequestModal\",\n    value: function activateGroupJoinRequestModal(msg) {\n      EventEmitter.publish('activateGroupJoinRequestModal', msg);\n    }\n  }, {\n    key: \"joinPrivateGroupOnApproval\",\n    value: function joinPrivateGroupOnApproval(msg) {\n      EventEmitter.publish('joinPrivateGroupOnApproval', msg);\n    }\n  }, {\n    key: \"notifyJoinRequestDeclined\",\n    value: function notifyJoinRequestDeclined(msg) {\n      EventEmitter.publish('notifyJoinRequestDeclined', msg);\n    }\n  }, {\n    key: \"notifyFetchGroups\",\n    value: function notifyFetchGroups() {\n      EventEmitter.publish('fetchGroups');\n    }\n  }, {\n    key: \"refreshScreenContainer\",\n    value: function refreshScreenContainer() {\n      EventEmitter.publish('refreshScreenContainer');\n    }\n  }, {\n    key: \"changeScreensharer\",\n    value: function changeScreensharer(msg) {\n      EventEmitter.publish('newScreensharer', msg);\n    }\n  }, {\n    key: \"activateWaitingForNewLeaderModal\",\n    value: function activateWaitingForNewLeaderModal(data) {\n      console.log(JSON.stringify(data));\n      EventEmitter.publish('activateWaitingForNewLeaderModal', data);\n    }\n  }, {\n    key: \"removeWaitingForNewLeaderModal\",\n    value: function removeWaitingForNewLeaderModal(newLeaderId) {\n      EventEmitter.publish('removeWaitingForNewLeaderModal', newLeaderId);\n    }\n  }, {\n    key: \"removeGroupJoinRequestModal\",\n    value: function removeGroupJoinRequestModal() {\n      EventEmitter.publish('removeGroupJoinRequestModal');\n    }\n  }, {\n    key: \"processConnectionMessage\",\n    value: function processConnectionMessage(e) {\n      var _JSON$parse = JSON.parse(e.data),\n          msgType = _JSON$parse.msgType,\n          msg = _JSON$parse.msg;\n\n      switch (msgType) {\n        case 'greetingAck':\n          this.initializeQueueOnGreeting(msg);\n          break;\n\n        case 'queue':\n          // in this case, the server will send a message indicating the current students in the queue\n          // msg - the new queue\n          this.updateStudentsInQueue(msg);\n          break;\n\n        case 'yourTurn':\n          // in this case, which is only if you are a student, the server notifies that it is your turn\n          // msg - the TA that notifies you\n          this.activateYourTurnModal(msg);\n          break;\n\n        case 'currStudentUpdate':\n          this.updateCurrStudent(msg);\n          break;\n\n        case 'receiveInvite':\n          // in this case, another student invites you to their group\n          // msg - sender, group\n          this.activateReceiveInviteModal(msg);\n          break;\n\n        case 'groupJoinRequest':\n          this.activateGroupJoinRequestModal(msg); // msg - the name of the student wanting to join\n\n          break;\n\n        case 'groupJoinRequestApproved':\n          this.joinPrivateGroupOnApproval(msg);\n          break;\n\n        case 'groupJoinRequestDeclined':\n          this.notifyJoinRequestDeclined(msg);\n          break;\n\n        case 'fetchGroups':\n          this.notifyFetchGroups();\n          break;\n\n        case 'newLeaderAppointed':\n          this.refreshScreenContainer();\n          break;\n\n        case 'fetchScreensharer':\n          this.changeScreensharer(msg);\n\n        case 'oldLeaderHasLeft':\n          // msg - the old leader Id and the group id\n          this.activateWaitingForNewLeaderModal(msg);\n          break;\n\n        case 'wonLeaderBid':\n          this.removeWaitingForNewLeaderModal(msg);\n          break;\n\n        case 'inviteStoppedWaitingForApproval':\n          this.removeGroupJoinRequestModal();\n          break;\n\n        default:\n          throw new Error(\"Message \".concat(msgType, \" is incorrectly formatted\"));\n      }\n    }\n  }, {\n    key: \"addMeToQueue\",\n    value: function addMeToQueue() {\n      this.connection.send(this.prepareMessage({\n        msgType: 'addToQueue',\n        msg: this.id\n      }));\n      EventEmitter.publish('addMeToQueue');\n    }\n  }, {\n    key: \"removeMeFromQueue\",\n    value: function removeMeFromQueue() {\n      this.connection.send(this.prepareMessage({\n        msgType: 'removeFromQueue',\n        msg: this.id\n      }));\n      EventEmitter.publish('removeMeFromQueue');\n    }\n  }, {\n    key: \"signalStudentTimeout\",\n    value: function signalStudentTimeout(TAName) {\n      this.connection.send(this.prepareMessage({\n        msgType: 'studentTimeout',\n        msg: TAName\n      }));\n    }\n  }, {\n    key: \"signalJoinTA\",\n    value: function signalJoinTA(group, TAName, me) {\n      this.connection.send(this.prepareMessage({\n        msgType: 'joinTA',\n        msg: JSON.stringify({\n          group: group,\n          TAName: TAName,\n          me: me\n        })\n      }));\n      EventEmitter.publish('clearLeftSide');\n    }\n  }, {\n    key: \"signalDeclineTA\",\n    value: function signalDeclineTA(TAName) {\n      this.connection.send(this.prepareMessage({\n        msgType: 'declineTA',\n        msg: TAName\n      }));\n    }\n  }, {\n    key: \"signalCallOver\",\n    value: function signalCallOver() {\n      this.connection.send(this.prepareMessage({\n        msgType: 'callOver',\n        msg: 'callOver'\n      }));\n    }\n  }, {\n    key: \"sendOutInvite\",\n    value: function sendOutInvite(sender, recepientId, group) {\n      this.connection.send(this.prepareMessage({\n        msgType: 'sendOutInvite',\n        msg: JSON.stringify({\n          sender: sender,\n          recepientId: recepientId,\n          group: group\n        })\n      }));\n    }\n  }, {\n    key: \"prepareMessage\",\n    value: function prepareMessage(msg) {\n      var courseId = this.courseId;\n\n      var enrichedPayload = _objectSpread(_objectSpread({}, msg), {}, {\n        courseId: courseId,\n        role: role\n      });\n\n      return JSON.stringify(enrichedPayload);\n    }\n  }]);\n\n  return StudentWebSocketClient;\n}();\n\nexport { StudentWebSocketClient as default };","map":{"version":3,"sources":["C:/Users/ryanj/Documents/mercury/util/studentWebSocket.js"],"names":["url","EventEmitter","role","StudentWebSocketClient","me","courseId","id","connection","WebSocket","onopen","processConnectionOpen","bind","onerror","processConnectionError","onmessage","processConnectionMessage","defineEventEmitterCallbacks","subscribe","send","prepareMessage","msgType","msg","TAName","signalStudentTimeout","group","signalJoinTA","signalDeclineTA","signalCallOver","addMeToQueue","removeMeFromQueue","sender","recepientIds","forEach","sendOutInvite","data","JSON","stringify","classId","userId","groupId","newLeader","oldLeader","error","console","log","publish","newLeaderId","e","parse","initializeQueueOnGreeting","updateStudentsInQueue","activateYourTurnModal","updateCurrStudent","activateReceiveInviteModal","activateGroupJoinRequestModal","joinPrivateGroupOnApproval","notifyJoinRequestDeclined","notifyFetchGroups","refreshScreenContainer","changeScreensharer","activateWaitingForNewLeaderModal","removeWaitingForNewLeaderModal","removeGroupJoinRequestModal","Error","recepientId","enrichedPayload"],"mappings":"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","sourcesContent":["const url = 'ws://localhost:8080'\r\nimport { EventEmitter } from '../components/util/EventEmitter'\r\nconst role = 'Student'\r\n/**\r\n * QueueWebSocket controls the web socket business logic for the course queue and\r\n * functions as a controller for the queue state\r\n */\r\n\r\nexport default class StudentWebSocketClient {\r\n  start({ me, courseId }) {\r\n    const { id } = me\r\n    this.id = id\r\n    this.courseId = courseId\r\n\r\n    this.connection = new WebSocket(url)\r\n    this.connection.onopen = this.processConnectionOpen.bind(this)\r\n    this.connection.onerror = this.processConnectionError.bind(this)\r\n    this.connection.onmessage = this.processConnectionMessage.bind(this)\r\n\r\n    this.defineEventEmitterCallbacks()\r\n  }\r\n\r\n  defineEventEmitterCallbacks() {\r\n    EventEmitter.subscribe('greeting', () => {\r\n      this.connection.send(\r\n        this.prepareMessage({\r\n          msgType: 'greeting',\r\n          msg: this.id,\r\n        })\r\n      )\r\n    })\r\n\r\n    EventEmitter.subscribe('signalStudentTimeout', (TAName) =>\r\n      this.signalStudentTimeout(TAName)\r\n    )\r\n\r\n    EventEmitter.subscribe('signalJoinTA', ({ group, TAName, me }) => {\r\n      this.signalJoinTA(group, TAName, me)\r\n    })\r\n\r\n    EventEmitter.subscribe('signalDeclineTA', (TAName) => {\r\n      this.signalDeclineTA(TAName)\r\n    })\r\n\r\n    EventEmitter.subscribe('signalCallOver', () => {\r\n      this.signalCallOver()\r\n    })\r\n\r\n    EventEmitter.subscribe('signalAddMeToQueue', () => {\r\n      this.addMeToQueue()\r\n    })\r\n\r\n    EventEmitter.subscribe('signalRemoveMeFromQueue', () => {\r\n      this.removeMeFromQueue()\r\n    })\r\n\r\n    EventEmitter.subscribe(\r\n      'sendOutInvite',\r\n      ({ sender, recepientIds, group }) => {\r\n        recepientIds.forEach((id) => {\r\n          this.sendOutInvite(sender, id, group)\r\n        })\r\n      }\r\n    )\r\n\r\n    EventEmitter.subscribe('requestJoinGroup', (data) => {\r\n      this.connection.send(\r\n        this.prepareMessage({\r\n          msgType: 'requestJoinGroup',\r\n          msg: JSON.stringify(data),\r\n        })\r\n      )\r\n    })\r\n\r\n    EventEmitter.subscribe('acceptGroupJoinRequest', (msg) => {\r\n      this.connection.send(\r\n        this.prepareMessage({\r\n          msgType: 'acceptGroupJoinRequest',\r\n          msg,\r\n        })\r\n      )\r\n    })\r\n\r\n    EventEmitter.subscribe('declineGroupJoinRequest', (msg) => {\r\n      this.connection.send(\r\n        this.prepareMessage({\r\n          msgType: 'declineGroupJoinRequest',\r\n          msg,\r\n        })\r\n      )\r\n    })\r\n\r\n    EventEmitter.subscribe('classGroupSetChanged', (classId) => {\r\n      this.connection.send(\r\n        this.prepareMessage({\r\n          msgType: 'classGroupSetChanged',\r\n          msg: classId,\r\n        })\r\n      )\r\n    })\r\n\r\n    EventEmitter.subscribe('userLeaveGroup', (group) => {\r\n      this.connection.send(\r\n        this.prepareMessage({\r\n          msgType: 'userLeaveGroup',\r\n          msg: group,\r\n        })\r\n      )\r\n    })\r\n\r\n    EventEmitter.subscribe('userJoinGroup', (data) => {\r\n      this.connection.send(\r\n        this.prepareMessage({\r\n          msgType: 'userJoinGroup',\r\n          msg: data,\r\n        })\r\n      )\r\n    })\r\n\r\n    EventEmitter.subscribe('bidForLeaderPosition', ({ userId, groupId }) => {\r\n      this.connection.send(\r\n        this.prepareMessage({\r\n          msgType: 'bidForLeaderPosition',\r\n          msg: { newLeader: this.id, oldLeader: userId, groupId },\r\n        })\r\n      )\r\n    })\r\n\r\n    EventEmitter.subscribe('screenShareOn', (data) => {\r\n      this.connection.send(\r\n        this.prepareMessage({\r\n          msgType: 'screenShareOn',\r\n          msg: data,\r\n        })\r\n      )\r\n    })\r\n\r\n    EventEmitter.subscribe('declineWaitingForRequestApproval', (group) => {\r\n      this.connection.send(\r\n        this.prepareMessage({\r\n          msgType: 'declineWaitingForRequestApproval',\r\n          msg: group,\r\n        })\r\n      )\r\n    })\r\n  }\r\n\r\n  processConnectionOpen() {\r\n    this.connection.send(\r\n      this.prepareMessage({\r\n        msgType: 'greeting',\r\n        msg: this.id,\r\n      })\r\n    ) // notify the server which courseId this websocket belongs to\r\n  }\r\n\r\n  processConnectionError(error) {\r\n    console.log(`WebSocket error: ${error}`)\r\n  }\r\n\r\n  activateYourTurnModal(TAName) {\r\n    EventEmitter.publish('activateYourTurnModal', TAName)\r\n  }\r\n\r\n  updateStudentsInQueue(msg) {\r\n    EventEmitter.publish('updateStudentsInQueue', msg)\r\n  }\r\n\r\n  updateCurrStudent(msg) {\r\n    EventEmitter.publish('updateCurrStudent', msg)\r\n  }\r\n\r\n  initializeQueueOnGreeting(msg) {\r\n    EventEmitter.publish('initializeQueueOnGreeting', msg)\r\n  }\r\n\r\n  activateReceiveInviteModal(msg) {\r\n    EventEmitter.publish('activateReceiveInviteModal', msg)\r\n  }\r\n\r\n  activateGroupJoinRequestModal(msg) {\r\n    EventEmitter.publish('activateGroupJoinRequestModal', msg)\r\n  }\r\n\r\n  joinPrivateGroupOnApproval(msg) {\r\n    EventEmitter.publish('joinPrivateGroupOnApproval', msg)\r\n  }\r\n\r\n  notifyJoinRequestDeclined(msg) {\r\n    EventEmitter.publish('notifyJoinRequestDeclined', msg)\r\n  }\r\n\r\n  notifyFetchGroups() {\r\n    EventEmitter.publish('fetchGroups')\r\n  }\r\n\r\n  refreshScreenContainer() {\r\n    EventEmitter.publish('refreshScreenContainer')\r\n  }\r\n\r\n  changeScreensharer(msg) {\r\n    EventEmitter.publish('newScreensharer', msg)\r\n  }\r\n\r\n  activateWaitingForNewLeaderModal(data) {\r\n    console.log(JSON.stringify(data))\r\n    EventEmitter.publish('activateWaitingForNewLeaderModal', data)\r\n  }\r\n\r\n  removeWaitingForNewLeaderModal(newLeaderId) {\r\n    EventEmitter.publish('removeWaitingForNewLeaderModal', newLeaderId)\r\n  }\r\n\r\n  removeGroupJoinRequestModal() {\r\n    EventEmitter.publish('removeGroupJoinRequestModal')\r\n  }\r\n\r\n  processConnectionMessage(e) {\r\n    const { msgType, msg } = JSON.parse(e.data)\r\n\r\n    switch (msgType) {\r\n      case 'greetingAck':\r\n        this.initializeQueueOnGreeting(msg)\r\n        break\r\n\r\n      case 'queue': // in this case, the server will send a message indicating the current students in the queue\r\n        // msg - the new queue\r\n        this.updateStudentsInQueue(msg)\r\n        break\r\n\r\n      case 'yourTurn': // in this case, which is only if you are a student, the server notifies that it is your turn\r\n        // msg - the TA that notifies you\r\n        this.activateYourTurnModal(msg)\r\n        break\r\n\r\n      case 'currStudentUpdate':\r\n        this.updateCurrStudent(msg)\r\n        break\r\n\r\n      case 'receiveInvite': // in this case, another student invites you to their group\r\n        // msg - sender, group\r\n        this.activateReceiveInviteModal(msg)\r\n        break\r\n\r\n      case 'groupJoinRequest':\r\n        this.activateGroupJoinRequestModal(msg) // msg - the name of the student wanting to join\r\n        break\r\n\r\n      case 'groupJoinRequestApproved':\r\n        this.joinPrivateGroupOnApproval(msg)\r\n        break\r\n\r\n      case 'groupJoinRequestDeclined':\r\n        this.notifyJoinRequestDeclined(msg)\r\n        break\r\n\r\n      case 'fetchGroups':\r\n        this.notifyFetchGroups()\r\n        break\r\n\r\n      case 'newLeaderAppointed':\r\n        this.refreshScreenContainer()\r\n        break\r\n\r\n      case 'fetchScreensharer':\r\n        this.changeScreensharer(msg)\r\n\r\n      case 'oldLeaderHasLeft':\r\n        // msg - the old leader Id and the group id\r\n        this.activateWaitingForNewLeaderModal(msg)\r\n        break\r\n\r\n      case 'wonLeaderBid':\r\n        this.removeWaitingForNewLeaderModal(msg)\r\n        break\r\n\r\n      case 'inviteStoppedWaitingForApproval':\r\n        this.removeGroupJoinRequestModal()\r\n        break\r\n\r\n      default:\r\n        throw new Error(`Message ${msgType} is incorrectly formatted`)\r\n    }\r\n  }\r\n\r\n  addMeToQueue() {\r\n    this.connection.send(\r\n      this.prepareMessage({\r\n        msgType: 'addToQueue',\r\n        msg: this.id,\r\n      })\r\n    )\r\n\r\n    EventEmitter.publish('addMeToQueue')\r\n  }\r\n\r\n  removeMeFromQueue() {\r\n    this.connection.send(\r\n      this.prepareMessage({\r\n        msgType: 'removeFromQueue',\r\n        msg: this.id,\r\n      })\r\n    )\r\n\r\n    EventEmitter.publish('removeMeFromQueue')\r\n  }\r\n\r\n  signalStudentTimeout(TAName) {\r\n    this.connection.send(\r\n      this.prepareMessage({\r\n        msgType: 'studentTimeout',\r\n        msg: TAName,\r\n      })\r\n    )\r\n  }\r\n\r\n  signalJoinTA(group, TAName, me) {\r\n    this.connection.send(\r\n      this.prepareMessage({\r\n        msgType: 'joinTA',\r\n        msg: JSON.stringify({ group, TAName, me }),\r\n      })\r\n    )\r\n\r\n    EventEmitter.publish('clearLeftSide')\r\n  }\r\n\r\n  signalDeclineTA(TAName) {\r\n    this.connection.send(\r\n      this.prepareMessage({\r\n        msgType: 'declineTA',\r\n        msg: TAName,\r\n      })\r\n    )\r\n  }\r\n\r\n  signalCallOver() {\r\n    this.connection.send(\r\n      this.prepareMessage({\r\n        msgType: 'callOver',\r\n        msg: 'callOver',\r\n      })\r\n    )\r\n  }\r\n\r\n  sendOutInvite(sender, recepientId, group) {\r\n    this.connection.send(\r\n      this.prepareMessage({\r\n        msgType: 'sendOutInvite',\r\n        msg: JSON.stringify({ sender, recepientId, group }),\r\n      })\r\n    )\r\n  }\r\n\r\n  prepareMessage(msg) {\r\n    const { courseId } = this\r\n    const enrichedPayload = { ...msg, courseId, role }\r\n    return JSON.stringify(enrichedPayload)\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}